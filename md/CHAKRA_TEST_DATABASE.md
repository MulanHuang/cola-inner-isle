# è„‰è½®æµ‹è¯• - äº‘æ•°æ®åº“ç»“æ„æ–‡æ¡£

## ğŸ“¦ æ•°æ®åº“é›†åˆ (Collections)

### 1. `chakra_history` - è„‰è½®æµ‹è¯•å†å²è®°å½•

å­˜å‚¨ç”¨æˆ·çš„è„‰è½®æµ‹è¯•ç»“æœå’Œå†å²è®°å½•ã€‚

#### å­—æ®µç»“æ„

```json
{
  "_id": "è‡ªåŠ¨ç”Ÿæˆçš„æ–‡æ¡£ID",
  "_openid": "ç”¨æˆ·çš„openidï¼ˆè‡ªåŠ¨æ·»åŠ ï¼‰",
  "answers": {
    "1": 3,
    "2": 4,
    "3": 2,
    // ... 80ä¸ªé¢˜ç›®çš„ç­”æ¡ˆ
  },
  "results": {
    "root": {
      "score": 45,
      "maxScore": 60,
      "percentage": 75
    },
    "sacral": {
      "score": 38,
      "maxScore": 55,
      "percentage": 69
    },
    "solar": {
      "score": 42,
      "maxScore": 60,
      "percentage": 70
    },
    "heart": {
      "score": 50,
      "maxScore": 60,
      "percentage": 83
    },
    "throat": {
      "score": 35,
      "maxScore": 55,
      "percentage": 64
    },
    "third_eye": {
      "score": 40,
      "maxScore": 55,
      "percentage": 73
    },
    "crown": {
      "score": 38,
      "maxScore": 55,
      "percentage": 69
    }
  },
  "testDate": "2024-01-15T10:30:00.000Z",
  "timestamp": 1705315800000
}
```

#### å­—æ®µè¯´æ˜

| å­—æ®µå | ç±»å‹ | è¯´æ˜ |
|--------|------|------|
| `_id` | String | æ–‡æ¡£å”¯ä¸€æ ‡è¯†ç¬¦ï¼ˆè‡ªåŠ¨ç”Ÿæˆï¼‰ |
| `_openid` | String | ç”¨æˆ·çš„å¾®ä¿¡ openidï¼ˆäº‘å‡½æ•°è‡ªåŠ¨æ·»åŠ ï¼‰ |
| `answers` | Object | ç”¨æˆ·çš„ç­”æ¡ˆï¼Œkey ä¸ºé¢˜ç›® idï¼Œvalue ä¸ºé€‰é¡¹å€¼ï¼ˆ1-5ï¼‰ |
| `results` | Object | 7ä¸ªè„‰è½®çš„è®¡ç®—ç»“æœ |
| `results.*.score` | Number | è¯¥è„‰è½®çš„å¾—åˆ† |
| `results.*.maxScore` | Number | è¯¥è„‰è½®çš„æœ€é«˜åˆ† |
| `results.*.percentage` | Number | è¯¥è„‰è½®çš„ç™¾åˆ†æ¯”ï¼ˆ0-100ï¼‰ |
| `testDate` | Date | æµ‹è¯•å®Œæˆæ—¶é—´ |
| `timestamp` | Number | æ—¶é—´æˆ³ï¼ˆæ¯«ç§’ï¼‰ |

#### ç´¢å¼•å»ºè®®

```javascript
// åœ¨å¾®ä¿¡äº‘å¼€å‘æ§åˆ¶å°åˆ›å»ºä»¥ä¸‹ç´¢å¼•
{
  "_openid": 1,
  "testDate": -1
}
```

è¿™æ ·å¯ä»¥å¿«é€ŸæŸ¥è¯¢æŸä¸ªç”¨æˆ·çš„æœ€æ–°æµ‹è¯•è®°å½•ã€‚

---

## ğŸ”§ æ•°æ®åº“æ“ä½œç¤ºä¾‹

### åˆ›å»ºé›†åˆ

åœ¨å¾®ä¿¡äº‘å¼€å‘æ§åˆ¶å°ï¼š
1. è¿›å…¥ã€Œäº‘å¼€å‘ã€â†’ã€Œæ•°æ®åº“ã€
2. ç‚¹å‡»ã€Œæ·»åŠ é›†åˆã€
3. è¾“å…¥é›†åˆåç§°ï¼š`chakra_history`
4. æƒé™è®¾ç½®ï¼šã€Œä»…åˆ›å»ºè€…å¯è¯»å†™ã€

### æŸ¥è¯¢æœ€æ–°æµ‹è¯•ç»“æœ

```javascript
const db = wx.cloud.database();

// æŸ¥è¯¢å½“å‰ç”¨æˆ·æœ€æ–°çš„æµ‹è¯•ç»“æœ
db.collection('chakra_history')
  .orderBy('testDate', 'desc')
  .limit(1)
  .get()
  .then(res => {
    if (res.data.length > 0) {
      const latestResult = res.data[0];
      console.log('æœ€æ–°æµ‹è¯•ç»“æœï¼š', latestResult);
    }
  });
```

### æŸ¥è¯¢å†å²è®°å½•

```javascript
// æŸ¥è¯¢å½“å‰ç”¨æˆ·æ‰€æœ‰æµ‹è¯•å†å²
db.collection('chakra_history')
  .orderBy('testDate', 'desc')
  .get()
  .then(res => {
    console.log('æµ‹è¯•å†å²ï¼š', res.data);
  });
```

### æ·»åŠ æµ‹è¯•ç»“æœ

```javascript
// ä¿å­˜æ–°çš„æµ‹è¯•ç»“æœ
db.collection('chakra_history')
  .add({
    data: {
      answers: answers,
      results: results,
      testDate: new Date(),
      timestamp: Date.now()
    }
  })
  .then(res => {
    console.log('ä¿å­˜æˆåŠŸï¼š', res._id);
  });
```

---

## ğŸ“Š ç¤ºä¾‹æ•°æ®

### å®Œæ•´ç¤ºä¾‹è®°å½•

```json
{
  "_id": "chakra_test_001",
  "_openid": "oABCD1234567890",
  "answers": {
    "1": 2, "2": 3, "3": 2, "4": 3, "5": 2, "6": 3, "7": 2, "8": 3, "9": 2, "10": 3,
    "11": 2, "12": 3, "13": 3, "14": 2, "15": 3, "16": 2, "17": 3, "18": 2, "19": 3,
    "20": 2, "21": 3, "22": 2, "23": 3, "24": 2, "25": 3, "26": 2, "27": 3, "28": 2,
    "29": 3, "30": 2, "31": 3, "32": 2, "33": 3, "34": 2, "35": 3, "36": 2, "37": 3,
    "38": 2, "39": 3, "40": 2, "41": 3, "42": 2, "43": 3, "44": 2, "45": 3, "46": 2,
    "47": 3, "48": 2, "49": 3, "50": 2, "51": 3, "52": 2, "53": 3, "54": 2, "55": 3,
    "56": 2, "57": 3, "58": 2, "59": 3, "60": 2, "61": 3, "62": 2, "63": 3, "64": 2,
    "65": 3, "66": 2, "67": 3, "68": 2, "69": 3, "70": 2, "71": 3, "72": 2, "73": 3,
    "74": 2, "75": 3, "76": 2, "77": 3, "78": 2, "79": 3, "80": 2
  },
  "results": {
    "root": { "score": 45, "maxScore": 60, "percentage": 75 },
    "sacral": { "score": 38, "maxScore": 55, "percentage": 69 },
    "solar": { "score": 42, "maxScore": 60, "percentage": 70 },
    "heart": { "score": 50, "maxScore": 60, "percentage": 83 },
    "throat": { "score": 35, "maxScore": 55, "percentage": 64 },
    "third_eye": { "score": 40, "maxScore": 55, "percentage": 73 },
    "crown": { "score": 38, "maxScore": 55, "percentage": 69 }
  },
  "testDate": "2024-01-15T10:30:00.000Z",
  "timestamp": 1705315800000
}
```

---

## ğŸ” æƒé™è®¾ç½®å»ºè®®

åœ¨äº‘å¼€å‘æ§åˆ¶å°è®¾ç½®é›†åˆæƒé™ï¼š

```json
{
  "read": "doc._openid == auth.openid",
  "write": "doc._openid == auth.openid"
}
```

è¿™æ ·ç¡®ä¿ç”¨æˆ·åªèƒ½è¯»å†™è‡ªå·±çš„æµ‹è¯•è®°å½•ã€‚

---

## ğŸ“ˆ æ•°æ®ç»Ÿè®¡ï¼ˆå¯é€‰æ‰©å±•ï¼‰

å¦‚æœéœ€è¦ç»Ÿè®¡åŠŸèƒ½ï¼Œå¯ä»¥åˆ›å»ºé¢å¤–çš„é›†åˆï¼š

### `chakra_statistics` - å…¨å±€ç»Ÿè®¡æ•°æ®

```json
{
  "_id": "stats_global",
  "totalTests": 1250,
  "averageScores": {
    "root": 72,
    "sacral": 68,
    "solar": 65,
    "heart": 78,
    "throat": 63,
    "third_eye": 70,
    "crown": 67
  },
  "lastUpdated": "2024-01-15T10:30:00.000Z"
}
```

---

## âœ… éƒ¨ç½²æ£€æŸ¥æ¸…å•

- [ ] åœ¨äº‘å¼€å‘æ§åˆ¶å°åˆ›å»º `chakra_history` é›†åˆ
- [ ] è®¾ç½®é›†åˆæƒé™ä¸ºã€Œä»…åˆ›å»ºè€…å¯è¯»å†™ã€
- [ ] åˆ›å»ºç´¢å¼•ï¼š`_openid` + `testDate`
- [ ] æµ‹è¯•æ·»åŠ è®°å½•åŠŸèƒ½
- [ ] æµ‹è¯•æŸ¥è¯¢è®°å½•åŠŸèƒ½
- [ ] ç¡®è®¤æ•°æ®æ­£ç¡®ä¿å­˜

---

## ğŸ¯ ä½¿ç”¨è¯´æ˜

1. **é¦–æ¬¡ä½¿ç”¨**ï¼šç¡®ä¿å·²å¼€é€šå¾®ä¿¡äº‘å¼€å‘
2. **åˆ›å»ºé›†åˆ**ï¼šæŒ‰ç…§ä¸Šè¿°æ­¥éª¤åˆ›å»º `chakra_history` é›†åˆ
3. **æµ‹è¯•åŠŸèƒ½**ï¼šå®Œæˆä¸€æ¬¡å®Œæ•´çš„è„‰è½®æµ‹è¯•
4. **æŸ¥çœ‹æ•°æ®**ï¼šåœ¨äº‘å¼€å‘æ§åˆ¶å°æŸ¥çœ‹ä¿å­˜çš„æ•°æ®
5. **è°ƒè¯•**ï¼šä½¿ç”¨å¾®ä¿¡å¼€å‘è€…å·¥å…·çš„äº‘å¼€å‘è°ƒè¯•åŠŸèƒ½

