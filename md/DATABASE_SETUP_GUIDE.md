# 📦 数据库设置指南 - 5分钟快速配置

## 🎯 问题说明

控制台显示错误：`DATABASE_COLLECTION_NOT_EXIST`

这是因为云数据库集合还没有创建。需要在微信开发者工具的云开发控制台中手动创建这些集合。

---

## 📋 需要创建的数据库集合（共10个）

### ✅ 用户数据集合（7个）- 权限：仅创建者可读写

| 集合名称 | 说明 | 优先级 |
|---------|------|--------|
| **users** | 用户基本信息（昵称、生日、星座、MBTI等） | ⭐⭐⭐ 必须 |
| **emotions** | 情绪记录 | ⭐⭐⭐ 必须 |
| **chats** | AI对话记录 | ⭐⭐ 重要 |
| **tarotDraws** | 塔罗抽牌记录 | ⭐⭐⭐ 必须 |
| **meditationHistory** | 冥想历史记录 | ⭐⭐ 重要 |
| **chakra_history** | 脉轮测试历史 | ⭐ 可选 |
| **tarotDraw** | 塔罗记录备用集合 | ⭐ 备用 |

### 📖 公共数据集合（3个）- 权限：所有用户可读

| 集合名称 | 说明 | 优先级 |
|---------|------|--------|
| **quotes** | 每日一句温暖语录 | ⭐⭐⭐ 必须 |
| **tarotCards** | 塔罗牌数据（22张大阿卡纳） | ⭐⭐⭐ 必须 |
| **meditations** | 冥想音频列表 | ⭐⭐ 重要 |

---

## 🚀 创建步骤（每个集合30秒）

### 第1步：打开云开发控制台

1. 打开微信开发者工具
2. 点击顶部菜单：**云开发** → **云开发控制台**
3. 左侧菜单选择：**数据库**

### 第2步：创建集合

#### 方法1：逐个创建（推荐新手）

1. 点击左侧的 **"+"** 按钮（添加集合）
2. 输入集合名称（如 `users`）
3. 点击"确定"
4. 重复以上步骤，创建所有10个集合

#### 方法2：批量创建（快速）

在云开发控制台的"数据库"页面，依次创建以下集合：

```
users
emotions
chats
tarotDraws
meditationHistory
chakra_history
tarotDraw
quotes
tarotCards
meditations
```

### 第3步：配置权限

#### 用户数据集合（7个）

对以下集合设置权限为：**仅创建者可读写**

- users
- emotions
- chats
- tarotDraws
- meditationHistory
- chakra_history
- tarotDraw

**操作步骤：**
1. 点击集合名称
2. 点击右上角"权限设置"
3. 选择"仅创建者可读写"
4. 点击"保存"

#### 公共数据集合（3个）

对以下集合设置权限为：**所有用户可读，仅创建者可写**

- quotes
- tarotCards
- meditations

**操作步骤：**
1. 点击集合名称
2. 点击右上角"权限设置"
3. 选择"所有用户可读，仅创建者可写"
4. 点击"保存"

---

## 📥 第4步：导入初始数据（重要！）

### 需要导入的数据文件

| 文件路径 | 导入到集合 | 说明 |
|---------|-----------|------|
| `database/init-data/quotes.json` | quotes | 15条温暖语录 |
| `database/init-data/tarotCards.json` | tarotCards | 22张塔罗牌数据 |
| `database/init-data/meditations.json` | meditations | 15个冥想音频 |

### 导入步骤

1. 在云开发控制台，点击对应的集合（如 `quotes`）
2. 点击"导入"按钮
3. 选择对应的 JSON 文件（如 `database/init-data/quotes.json`）
4. 选择导入模式：**JSON**
5. 点击"确定"导入
6. 等待导入完成

---

## ✅ 验证配置

### 检查集合是否创建成功

在云开发控制台的"数据库"页面，应该能看到10个集合：

- ✅ users
- ✅ emotions
- ✅ chats
- ✅ tarotDraws
- ✅ meditationHistory
- ✅ chakra_history
- ✅ tarotDraw
- ✅ quotes（应该有15条数据）
- ✅ tarotCards（应该有22条数据）
- ✅ meditations（应该有15条数据）

### 测试功能

1. **重新编译小程序**
2. 测试以下功能：
   - 首页：每日一句应该正常显示
   - 情绪记录：可以保存情绪
   - 塔罗牌：可以抽牌
   - 用户中心：可以编辑昵称
   - 统计数据：显示各项记录数量

---

## 🔧 常见问题

### Q1: 找不到"云开发"菜单？

**A:** 确保：
1. 已在 `project.config.json` 中配置了正确的 AppID
2. 基础库版本 >= 2.2.3
3. 已开通云开发服务

### Q2: 创建集合后仍然报错？

**A:** 请检查：
1. 权限是否正确配置
2. 是否已导入初始数据（quotes、tarotCards、meditations）
3. 重新编译小程序

### Q3: 导入数据失败？

**A:** 确保：
1. JSON 文件格式正确
2. 选择了正确的导入模式（JSON）
3. 集合权限允许写入

---

## 📞 完成后的检查清单

- [ ] 创建了10个数据库集合
- [ ] 配置了正确的权限（用户数据：仅创建者可读写；公共数据：所有用户可读）
- [ ] 导入了3个初始数据文件
- [ ] 重新编译了小程序
- [ ] 测试了主要功能（首页、情绪记录、塔罗牌）
- [ ] 控制台没有数据库错误

---

**预计完成时间：5-10分钟**

完成后，所有数据库相关的错误应该都会消失！🎉

