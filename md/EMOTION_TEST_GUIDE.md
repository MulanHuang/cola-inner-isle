# 🧪 情绪记录功能测试指南

## 🎯 测试目标

验证情绪记录页面的改进是否生效，确保云数据库和本地存储降级都能正常工作。

---

## 📋 测试前准备

### 1. **清除缓存**
```
微信开发者工具 → 工具 → 清除缓存 → 清除全部缓存
```

### 2. **重新编译**
```
点击「编译」按钮
```

### 3. **打开控制台**
```
点击「Console」标签，查看日志输出
```

---

## ✅ 测试步骤

### **测试 1：温暖一句功能**

#### 步骤：
1. 进入情绪记录页面（pages/emotion/emotion）
2. 查看页面顶部的「温暖一句」卡片
3. 点击「换一句温暖」按钮

#### 预期结果：
- ✅ 页面顶部显示温暖文案
- ✅ 点击刷新按钮后文案会改变
- ✅ 控制台显示以下日志之一：
  - `✅ 从云数据库加载温暖一句成功`（云数据库可用）
  - `⚠️ 云数据库加载失败，使用本地数据` + `✅ 使用本地温暖一句`（降级）

---

### **测试 2：选择情绪**

#### 步骤：
1. 在「此刻的你，感觉如何？」区域选择一个情绪（如「开心 😊」）
2. 观察页面变化

#### 预期结果：
- ✅ 选中的情绪卡片高亮显示
- ✅ 下方显示情绪反馈文案（如「真好，看到你开心的样子 ✨」）

---

### **测试 3：填写内容**

#### 步骤：
1. 设置「今日能量指数」（点击星星）
2. 填写「今日感恩小事」（至少填写一项）
3. 填写「今日小成就」（至少填写一项）
4. 填写「自由输入区」（可选）
5. 选择标签（可选）

#### 预期结果：
- ✅ 所有输入框正常工作
- ✅ 字数统计正常显示
- ✅ 模板按钮可以快速插入文本

---

### **测试 4：保存情绪记录**

#### 步骤：
1. 点击「保存今日日记」按钮
2. 等待保存完成
3. 查看控制台日志

#### 预期结果：
- ✅ 显示「正在温柔记录...」加载提示
- ✅ 保存成功后显示「今日日记已温柔记录 💝」
- ✅ 表单自动重置
- ✅ 控制台显示以下日志之一：
  - `✅ 情绪记录已保存到云数据库`（云数据库可用）
  - `⚠️ 云数据库保存失败，使用本地存储` + `✅ 情绪记录已保存到本地存储`（降级）

---

### **测试 5：查看历史记录**

#### 步骤：
1. 点击「查看历史」按钮
2. 进入历史记录页面
3. 查看控制台日志

#### 预期结果：
- ✅ 显示刚才保存的情绪记录
- ✅ 显示记录的时间（如「今天 10:30」）
- ✅ 显示总记录数和连续记录天数
- ✅ 控制台显示以下日志之一：
  - `✅ 从云数据库加载历史记录成功 X 条`（云数据库可用）
  - `⚠️ 云数据库加载失败，使用本地存储` + `✅ 从本地存储加载历史记录 X 条`（降级）

---

### **测试 6：本地存储验证**

#### 步骤：
1. 在开发者工具中点击「Storage」标签
2. 查找 `localEmotions` 键

#### 预期结果：
- ✅ 如果使用了本地存储降级，应该能看到 `localEmotions` 数据
- ✅ 数据格式为数组，包含刚才保存的记录

---

## 🔍 常见问题排查

### **问题 1：温暖一句不显示**

**可能原因**：
- 代码未保存或未重新编译

**解决方法**：
1. 确保所有文件已保存
2. 清除缓存并重新编译
3. 查看控制台是否有错误

---

### **问题 2：保存失败**

**可能原因**：
- 未选择情绪
- 网络问题

**解决方法**：
1. 确保已选择情绪（必填项）
2. 查看控制台错误日志
3. 检查是否成功降级到本地存储

---

### **问题 3：历史记录为空**

**可能原因**：
- 还没有保存过记录
- 本地存储被清除

**解决方法**：
1. 先保存一条情绪记录
2. 检查 Storage 中是否有 `localEmotions` 数据
3. 查看控制台日志

---

## 📊 测试检查清单

完成以下所有测试项：

- [ ] 温暖一句正常显示
- [ ] 刷新温暖一句功能正常
- [ ] 选择情绪功能正常
- [ ] 填写表单功能正常
- [ ] 保存情绪记录成功
- [ ] 查看历史记录正常
- [ ] 控制台日志清晰友好
- [ ] 云数据库可用时使用云数据库
- [ ] 云数据库不可用时自动降级到本地存储
- [ ] 本地存储数据格式正确

---

## 🎉 测试完成

如果所有测试项都通过，说明改进成功！

**现在情绪记录功能具有：**
- ✅ 高可用性（云数据库 + 本地存储双保险）
- ✅ 用户友好（无感知降级）
- ✅ 易于调试（清晰的日志）

**享受使用吧！** 🌸✨

