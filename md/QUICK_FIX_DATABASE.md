# ⚡ 快速修复数据库错误 - 3步搞定

## 🎯 当前问题

控制台显示：`DATABASE_COLLECTION_NOT_EXIST` - 数据库集合不存在

---

## 🚀 快速修复（5分钟）

### 第1步：打开云开发控制台（30秒）

```
微信开发者工具 → 顶部菜单"云开发" → "云开发控制台" → 左侧"数据库"
```

### 第2步：创建10个数据库集合（2分钟）

点击左侧的 **"+"** 按钮，依次创建以下集合：

#### 必须创建（优先级⭐⭐⭐）

```
1. users          - 用户信息
2. emotions       - 情绪记录
3. tarotDraws     - 塔罗记录
4. quotes         - 每日一句
5. tarotCards     - 塔罗牌数据
```

#### 重要功能（优先级⭐⭐）

```
6. chats              - AI对话记录
7. meditationHistory  - 冥想历史
8. meditations        - 冥想音频列表
```

#### 可选功能（优先级⭐）

```
9. chakra_history  - 脉轮测试历史
10. tarotDraw      - 塔罗记录备用
```

### 第3步：配置权限（2分钟）

#### A. 用户数据集合 → 仅创建者可读写

对以下7个集合设置：**仅创建者可读写**

```
users
emotions
chats
tarotDraws
meditationHistory
chakra_history
tarotDraw
```

**操作：** 点击集合 → 右上角"权限设置" → 选择"仅创建者可读写" → 保存

#### B. 公共数据集合 → 所有用户可读

对以下3个集合设置：**所有用户可读，仅创建者可写**

```
quotes
tarotCards
meditations
```

**操作：** 点击集合 → 右上角"权限设置" → 选择"所有用户可读，仅创建者可写" → 保存

---

## 📥 第4步：导入初始数据（1分钟）

### 必须导入的数据

| 文件 | 导入到集合 | 数据量 |
|------|-----------|--------|
| `database/init-data/quotes.json` | quotes | 15条 |
| `database/init-data/tarotCards.json` | tarotCards | 22张 |
| `database/init-data/meditations.json` | meditations | 15个 |

### 导入方法

1. 在云开发控制台，点击集合名称（如 `quotes`）
2. 点击"导入"按钮
3. 选择对应的 JSON 文件
4. 导入模式选择：**JSON**
5. 点击"确定"

---

## ✅ 验证修复

### 1. 检查集合列表

在云开发控制台应该看到10个集合，其中：
- quotes 有 15 条数据
- tarotCards 有 22 条数据
- meditations 有 15 条数据

### 2. 重新编译小程序

在微信开发者工具中点击"编译"按钮

### 3. 测试功能

- ✅ 首页：每日一句正常显示
- ✅ 情绪记录：可以保存
- ✅ 塔罗牌：可以抽牌
- ✅ 用户中心：可以编辑昵称
- ✅ 控制台：没有数据库错误

---

## 📸 图文教程

如果需要详细的图文教程，请查看：
- `数据库权限配置-图文教程.md`
- `快速修复数据库权限.md`

---

## 🔧 常见问题

### Q: 创建集合后仍然报错？

**A:** 请确保：
1. ✅ 权限已正确配置
2. ✅ 已导入初始数据（quotes、tarotCards、meditations）
3. ✅ 已重新编译小程序

### Q: 找不到"云开发"菜单？

**A:** 请检查：
1. `project.config.json` 中的 AppID 是否正确
2. 是否已开通云开发服务
3. 基础库版本是否 >= 2.2.3

### Q: 导入数据失败？

**A:** 确保：
1. JSON 文件路径正确
2. 选择了"JSON"导入模式
3. 集合权限允许写入

---

## 📋 完成检查清单

- [ ] 创建了10个数据库集合
- [ ] 配置了正确的权限
- [ ] 导入了3个初始数据文件
- [ ] 重新编译了小程序
- [ ] 测试了主要功能
- [ ] 控制台没有错误

---

**完成后，所有数据库错误都会消失！** 🎉

如果还有问题，请查看详细文档：`DATABASE_SETUP_GUIDE.md`

