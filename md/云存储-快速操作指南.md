# 云存储快速操作指南 ⚡

## 🎯 目标
将 206MB 的塔罗牌图片移到云存储，解决主包体积超限问题。

---

## ⏱️ 预计时间：15 分钟

---

## 📋 操作步骤

### 1️⃣ 开通云开发（2 分钟）

```
微信开发者工具 → 顶部菜单 "云开发" → 开通
```

- 选择 **"按量付费"**（有免费额度）
- 环境名称：`cloud1-5gc5jltwbcbef586`
- 等待初始化完成

---

### 2️⃣ 创建存储文件夹（1 分钟）

```
云开发控制台 → 存储 → 文件管理 → 新建文件夹
```

创建文件夹：
- `tarot/`
- `audio/`
- `meditation/`

---

### 3️⃣ 上传塔罗牌图片（5 分钟）

```
云开发控制台 → 存储 → tarot 文件夹 → 上传文件
```

**上传文件**：
- 选择 `images/tarrot-cards/PNG/` 目录下的所有 PNG 文件
- 批量上传（可以一次选择多个）
- 保持原文件名

**需要上传的文件**（22 张）：
```
0-The Fool.png
1-The Magician.png
2-The High Priestess.png
3-The Empress.png
4-The Emperor.png
5-The Hierophant.png
6-The Lovers.png
7-The Chariot.png
8-Strength.png
9-The Hermit.png
10-Wheel of Fortune.png
11-Justice.png
12-The Hanged Man.png
13-Death.png
14-Temperance.png
15-The Devil.png
16-The Tower.png
17-The Star.png
18-The Moon.png
19-The Sun.png
20-Judgement.png
21-The World.png
```

---

### 4️⃣ 获取云存储环境 ID（2 分钟）

上传完成后，点击任意文件，查看 **"File ID"**：

```
cloud://cloud1-5gc5jltwbcbef586.636c-cloud1-5gc5jltwbcbef586-1330238286/tarot/0-The Fool.png
         ^^^^^^^^^^^^^^^^^^^^^^^^ ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
         环境 ID（前半部分）        环境 ID（后半部分，数字）
```

**记录完整的环境 ID**：
```
cloud1-5gc5jltwbcbef586.636c-cloud1-5gc5jltwbcbef586-1330238286
```

---

### 5️⃣ 更新环境 ID（如果不同）（1 分钟）

如果您的环境 ID 与示例不同，需要批量替换：

1. 打开 `database/init-data/tarotCards-cloud.json`
2. 使用编辑器的 **"查找替换"** 功能
3. 查找：`cloud1-5gc5jltwbcbef586.636c-cloud1-5gc5jltwbcbef586-1330238286`
4. 替换为：`您的实际环境ID`
5. 全部替换

---

### 6️⃣ 导入数据库（2 分钟）

```
云开发控制台 → 数据库 → tarotCards 集合 → 导入
```

- 选择文件：`database/init-data/tarotCards-cloud.json`
- 导入模式：**覆盖导入**
- 点击 **"确定"**

---

### 7️⃣ 设置云存储权限（1 分钟）

```
云开发控制台 → 存储 → 权限设置
```

添加规则：
```json
{
  "read": true,
  "write": false
}
```

这样所有用户都可以读取文件。

---

### 8️⃣ 删除本地大文件（1 分钟）

**⚠️ 重要：先备份！**

```bash
# 备份（可选）
mkdir ~/Desktop/InnerSeed-backup
cp -r images/tarrot-cards ~/Desktop/InnerSeed-backup/

# 删除本地文件
rm -rf images/tarrot-cards
```

或者在 Finder 中：
1. 找到 `images/tarrot-cards` 文件夹
2. 拖到废纸篓
3. 清空废纸篓

---

### 9️⃣ 测试功能（3 分钟）

1. 在微信开发者工具中点击 **"编译"**
2. 进入 **"塔罗牌"** 页面
3. 点击 **"抽取塔罗牌"**
4. 确认图片能正常显示

**如果图片无法显示**：
- 打开控制台查看错误信息
- 检查云存储文件 ID 是否正确
- 检查云存储权限是否设置

---

### 🔟 重新上传小程序（2 分钟）

1. 点击顶部 **"上传"** 按钮
2. 填写版本号：`1.0.1`
3. 填写备注：`优化：使用云存储，减小主包体积`
4. 点击 **"上传"**

**预期结果**：
- ✅ 主包体积：< 1.5MB
- ✅ 代码质量检查：通过
- ✅ 上传成功

---

## 📊 效果对比

| 项目 | 优化前 | 优化后 |
|------|--------|--------|
| 主包体积 | > 200MB | < 1.5MB |
| 塔罗牌图片 | 206MB（本地） | 0MB（云存储） |
| 上传状态 | ❌ 失败 | ✅ 成功 |

---

## ⚠️ 注意事项

1. **环境 ID**：确保使用您实际的环境 ID
2. **文件名**：上传时保持原文件名
3. **权限**：设置为 "所有用户可读"
4. **备份**：删除前务必备份
5. **测试**：上传后测试功能

---

## 🐛 常见问题

### Q: 图片显示空白
**A**: 检查云存储文件 ID 是否正确，确保包含完整的环境 ID

### Q: 提示权限不足
**A**: 在云开发控制台设置权限为 "所有用户可读"

### Q: 找不到文件
**A**: 确认文件已上传到正确的文件夹（tarot/）

---

## ✅ 完成检查清单

- [ ] 开通云开发环境
- [ ] 创建 tarot 文件夹
- [ ] 上传 22 张塔罗牌图片
- [ ] 获取云存储环境 ID
- [ ] 更新 tarotCards-cloud.json（如需要）
- [ ] 导入数据库
- [ ] 设置云存储权限
- [ ] 删除本地大文件
- [ ] 测试塔罗牌功能
- [ ] 重新上传小程序

---

## 🎉 完成！

现在您的小程序主包体积已经大幅减小，可以成功上传了！

如有问题，请查看详细的 `云存储部署指南.md` 文档。

