# 快速修复指南 - 真机音频播放 🚀

## ⚡ 3 步快速修复

### 第 1 步：修改 app.js（1 分钟）

打开 `app.js`，找到第 13 行：

```javascript
const cloudEnvId = "cloud1-5gc5jltwbcbef586"; // ← 替换为你的实际环境 ID
```

**如何获取环境 ID**：
1. 微信开发者工具 → 云开发 → 设置
2. 复制 "环境 ID"
3. 替换上面的字符串

---

### 第 2 步：检查数据库（2 分钟）

打开云开发控制台 → 数据库 → `meditations` 集合

确认每条记录都有 `audioUrl` 字段，格式如下：

```
cloud://环境ID/audio/文件名.mp3
```

示例：
```
cloud://cloud1-5gc5jltwbcbef586.636c-cloud1-5gc5jltwbcbef586-1330238286/audio/顶轮之光.mp3
```

---

### 第 3 步：真机调试（2 分钟）

1. 微信开发者工具 → 预览 → **真机调试**（不是预览）
2. 手机扫码
3. 打开 vConsole（右下角悬浮按钮）
4. 点击播放音频
5. 查看日志

---

## ✅ 成功的日志

如果看到以下日志，说明修复成功：

```
[App] 云开发初始化成功，环境 ID: xxx
[player] ✅ 成功获取临时链接: https://xxx
[player] ✅ 音频管理器配置完成，等待播放...
[player] ✅ 音频开始播放
```

---

## ❌ 常见错误

### 错误 1：获取临时链接失败

```
[player] ❌ 获取临时链接失败
[player] - 错误码: -1
```

**解决方法**：
1. 检查 `app.js` 中的环境 ID 是否正确
2. 检查云存储权限：云开发 → 存储 → 权限设置 → "所有用户可读"

---

### 错误 2：音频播放错误

```
[player] ❌ 音频播放错误
[player] 错误码: 10001
```

**解决方法**：
1. 确保音频文件格式为 MP3
2. 检查网络连接
3. 重新上传音频文件到云存储

---

## 🔑 关键代码（已修复）

### app.js - 云开发初始化

```javascript
// ✅ 使用具体的环境 ID（真机兼容性好）
const cloudEnvId = "cloud1-5gc5jltwbcbef586";
wx.cloud.init({
  env: cloudEnvId,
  traceUser: true,
});
```

### player.js - BackgroundAudioManager 配置

```javascript
// ✅ iOS 真机必须先设置 title
audioManager.title = "冥想音频";
audioManager.epname = "可乐心岛冥想";
audioManager.singer = "可乐心岛";
audioManager.coverImgUrl = coverUrl;

// ✅ src 必须最后设置
audioManager.src = tempUrl;
```

---

## 📋 检查清单

- [ ] `app.js` 中的环境 ID 已替换
- [ ] 数据库中的 `audioUrl` 字段格式正确
- [ ] 云存储权限设置为 "所有用户可读"
- [ ] 使用 "真机调试" 而不是 "预览"
- [ ] 手机上已打开 vConsole

---

## 📞 需要帮助？

查看详细文档：
- `真机音频播放问题-修复总结.md` - 完整的修复说明
- `真机音频播放调试指南.md` - 详细的调试步骤
- `音频播放-代码示例.md` - 代码示例

---

**最后更新**: 2025-11-23

