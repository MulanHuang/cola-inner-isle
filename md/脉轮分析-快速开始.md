# 🚀 脉轮分析功能 - 快速开始指南

## ⚡ 5 分钟快速部署

### 步骤 1：上传云函数（2 分钟）

1. 打开微信开发者工具
2. 找到 `cloudfunctions/analyzeChakraResult` 文件夹
3. 右键点击 → 选择 **"上传并部署：云端安装依赖"**
4. 等待上传完成（约 1-2 分钟）

### 步骤 2：配置环境变量（1 分钟）

1. 打开微信云开发控制台
2. 进入 **云函数** → **配置** → **环境变量**
3. 添加以下变量：
   ```
   OPENAI_API_KEY = sk-xxxxxxxxxxxxxxxx（你的OpenAI API Key）
   OPENAI_MODEL = gpt-3.5-turbo（可选，默认gpt-5-mini）
   ```
4. 保存配置

### 步骤 3：测试云函数（1 分钟）

1. 在云开发控制台 → **云函数** → **analyzeChakraResult**
2. 点击 **"测试"** 按钮
3. 输入测试数据：
   ```json
   {
     "chakraScores": {
       "root": 38,
       "sacral": 40,
       "solarPlexus": 32,
       "heart": 45,
       "throat": 37,
       "thirdEye": 36,
       "crown": 37
     },
     "level": "中等平衡",
     "strongChakras": ["heart", "sacral"],
     "weakChakras": ["solarPlexus", "root"],
     "language": "zh"
   }
   ```
4. 点击 **"运行测试"**
5. 确认返回包含 `success: true` 和完整的 `data` 对象

### 步骤 4：前端测试（1 分钟）

1. 在小程序中完成一次脉轮测试
2. 查看结果页面
3. 确认显示以下内容：
   - ✅ AI 智能分析（整体总结）
   - ✅ 各脉轮详细分析（7 个脉轮）
   - ✅ 可以相信的自己
   - ✅ 适合关注的方向
   - ✅ 日常小练习

---

## 🎯 验证成功的标志

### ✅ 云函数测试成功

返回数据应该包含：

```json
{
  "success": true,
  "data": {
    "overall_summary": "...",
    "chakra_details": [...],
    "strengths": [...],
    "growth_focus": [...],
    "simple_practices": [...]
  }
}
```

### ✅ 前端显示正常

用户界面应该显示：

```
┌─────────────────────────────┐
│  ✨ AI 智能分析              │
│  （整体总结文本）            │
└─────────────────────────────┘

┌─────────────────────────────┐
│  🌈 各脉轮详细分析           │
│  海底轮 - 38分               │
│  💭 你可能会有的感受         │
│  💡 今天可以试试             │
│  • 建议1                     │
│  • 建议2                     │
│  • 建议3                     │
│  （共7个脉轮）               │
└─────────────────────────────┘

┌─────────────────────────────┐
│  🌟 可以相信的自己           │
│  • 优势1                     │
│  • 优势2                     │
└─────────────────────────────┘

┌─────────────────────────────┐
│  🌱 适合关注的方向           │
│  • 关注点1                   │
│  • 关注点2                   │
└─────────────────────────────┘

┌─────────────────────────────┐
│  🧘‍♀️ 日常小练习              │
│  • 练习1                     │
│  • 练习2                     │
│  • 练习3                     │
└─────────────────────────────┘
```

---

## 🐛 常见问题快速解决

### 问题 1：云函数调用失败

**症状：** 控制台显示 "云函数调用失败"

**快速解决：**

```bash
# 检查云函数是否已上传
1. 云开发控制台 → 云函数 → 查看 analyzeChakraResult 是否存在
2. 如果不存在，重新上传云函数
```

### 问题 2：显示"本次详细分析未能生成"

**症状：** 显示错误兜底文案

**快速解决：**

```bash
# 检查环境变量
1. 云开发控制台 → 云函数 → 配置 → 环境变量
2. 确认 OPENAI_API_KEY 已配置且正确
3. 查看云函数日志，确认错误原因
```

### 问题 3：只显示整体总结

**症状：** 只有 overall_summary，其他部分不显示

**快速解决：**

```bash
# 检查返回数据
1. 打开控制台
2. 查看 "📦 云函数返回数据" 日志
3. 确认返回包含 chakra_details、strengths 等字段
4. 如果缺失，检查 OpenAI API 返回是否正常
```

---

## 📞 获取帮助

### 查看日志

**云函数日志：**

1. 云开发控制台 → 云函数 → analyzeChakraResult → 日志
2. 查看最近的调用记录和错误信息

**前端日志：**

1. 微信开发者工具 → 控制台
2. 查看以下关键日志：
   - "准备调用云函数 analyzeChakraResult"
   - "📥 云函数原始返回"
   - "✅ AI 分析成功" 或 "❌ 云函数调用失败"

### 参考文档

- **详细指南：** `md/脉轮分析功能修复指南.md`
- **修改对比：** `md/脉轮分析-修改对比.md`
- **完成总结：** `md/脉轮分析功能-完成总结.md`

---

## 💡 优化建议

### 降低成本

```javascript
// 在云函数中调整 maxTokens
options: {
  model: "gpt-3.5-turbo",  // 使用更便宜的模型
  temperature: 1,
  maxTokens: 1500,  // 减少 token 数量
  timeout: 30000,
}
```

### 提高速度

```javascript
// 使用更快的模型
options: {
  model: "gpt-3.5-turbo",  // 比 GPT-4 快3-5倍
  temperature: 1,
  maxTokens: 1500,
  timeout: 20000,  // 减少超时时间
}
```

### 添加缓存

```javascript
// 在前端添加缓存逻辑
const cacheKey = `chakra_analysis_${JSON.stringify(chakraScores)}`;
const cached = wx.getStorageSync(cacheKey);
if (cached && Date.now() - cached.timestamp < 24 * 60 * 60 * 1000) {
  // 使用缓存的结果
  this.setData({ aiAnalysis: cached.data });
  return;
}
```

---

## ✅ 完成清单

部署完成后，确认以下项目：

- [ ] 云函数已上传
- [ ] 环境变量已配置
- [ ] 云函数测试通过
- [ ] 前端测试通过
- [ ] AI 分析正确显示
- [ ] 错误处理正常工作
- [ ] 用户体验良好

---

## 🎉 恭喜！

如果所有步骤都完成，你的脉轮分析功能现在应该正常运作了！

用户现在可以获得：

- 💎 详细的脉轮能量分析
- 💎 每个脉轮的具体建议
- 💎 温柔的陪伴和鼓励
- 💎 可操作的日常练习

享受你的新功能吧！ 🌈✨
