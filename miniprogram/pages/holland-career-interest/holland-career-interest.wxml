<!-- pages/holland-career-interest/holland-career-interest.wxml -->

<view class="container">

  <!-- 介绍页 -->
  <view wx:if="{{showIntro}}" class="intro">
    <view class="intro-card">
      <view class="history-entry history-entry-in-card" bindtap="handleHistoryNav" aria-label="历史记录">
        <view class="history-entry-card">
          <view class="history-icon history-icon-clipboard">
            <view class="clipboard-tab"></view>
            <view class="clipboard-body"></view>
            <view class="clipboard-line clipboard-line-1"></view>
            <view class="clipboard-line clipboard-line-2"></view>
          </view>
          <text class="history-entry-text">历史记录</text>
          <view wx:if="{{historyList.length}}" class="history-entry-dot"></view>
        </view>
      </view>
      <view class="intro-emblem">
        <view class="intro-emblem-ring"></view>
        <view class="intro-emblem-dot"></view>
      </view>
      <view class="intro-title">霍兰德职业兴趣探索</view>
      <view class="intro-subtitle">
        通过 RIASEC 六维度，观察你在行动与环境偏好上的能量分布。
      </view>

      <view class="intro-meta">
        <view class="intro-chip">{{totalQuestions}} 题</view>
        <view class="intro-chip">{{dimensions.length}} 维度</view>
        <view class="intro-chip">约 {{estimatedMinutes}} 分钟</view>
      </view>

      <view class="intro-desc">
        每个维度代表一种行动能量。越靠前的维度，越容易让你进入状态。
      </view>
      <view class="intro-desc">
        这是一份自我理解的探索，不用于评判，也不提供职业建议。
      </view>

      <view class="intro-divider">
        <view class="intro-divider-line"></view>
        <view class="intro-divider-text">开始探索</view>
        <view class="intro-divider-line"></view>
      </view>

      <view class="intro-radar">
        <view class="intro-radar-shape"></view>
        <view class="intro-radar-label top">实用型</view>
        <view class="intro-radar-label top-right">研究型</view>
        <view class="intro-radar-label bottom-right">艺术型</view>
        <view class="intro-radar-label bottom">社会型</view>
        <view class="intro-radar-label bottom-left">企业型</view>
        <view class="intro-radar-label top-left">务实型</view>
      </view>

      <view class="intro-note">
        直觉作答即可，答案没有好坏之分。
      </view>

      <view class="intro-steps">
        <view class="intro-step">
          <text class="intro-step-index">1</text>
          <text class="intro-step-text">直觉作答</text>
        </view>
        <view class="intro-step">
          <text class="intro-step-index">2</text>
          <text class="intro-step-text">完成 {{totalQuestions}} 题</text>
        </view>
        <view class="intro-step">
          <text class="intro-step-index">3</text>
          <text class="intro-step-text">查看能量画像</text>
        </view>
      </view>
    </view>

    <button class="btn primary" bindtap="handleStart">开始测试</button>
  </view>

  <!-- 测试中 -->
  <view wx:elif="{{!finished}}" class="quiz">
    <view class="progress">
      <view class="progress-text">
        <text class="progress-current">{{currentIndex + 1}}</text>
        <text class="progress-sep">/</text>
        <text class="progress-total">{{questions.length}}</text>
      </view>
      <view class="progress-bar">
        <view class="progress-bar-inner" style="width: {{progressPercent}}%"></view>
      </view>
    </view>

    <view class="card">
      <view class="dimension">{{questions[currentIndex].dimensionName}}</view>
      <view class="question">
        {{questions[currentIndex].text}}
      </view>

      <view class="options-bar">
        <view
          class="option-pill {{currentAnswer === item.value ? 'option-pill-active' : ''}}"
          wx:for="{{scaleLabels}}"
          wx:key="value"
          data-value="{{item.value}}"
          bindtap="handleSelect"
        >
          <text class="option-label">{{item.shortLabel}}</text>
        </view>
      </view>

    </view>

    <view class="actions">
      <button class="btn ghost" bindtap="handlePrev" disabled="{{currentIndex === 0}}">
        上一题
      </button>
      <button class="btn ghost" bindtap="handleRestart">重置</button>
    </view>

    <view class="scale-hint">直觉作答即可</view>
  </view>

  <!-- 结果页 -->
  <view wx:else class="result">
    <view class="history-entry" bindtap="handleHistoryNav" aria-label="历史记录">
      <view class="history-entry-card">
        <view class="history-icon history-icon-clipboard">
          <view class="clipboard-tab"></view>
          <view class="clipboard-body"></view>
          <view class="clipboard-line clipboard-line-1"></view>
          <view class="clipboard-line clipboard-line-2"></view>
        </view>
        <text class="history-entry-text">历史记录</text>
        <view wx:if="{{historyList.length}}" class="history-entry-dot"></view>
      </view>
    </view>
    <view class="title">你的行动能量画像</view>

    <view class="radar-card">
      <view class="radar-header">
        <text class="radar-title">行动能量分布</text>
        <text class="radar-subtitle">满分 {{maxDimensionTotal}}</text>
      </view>
      <canvas canvas-id="radarCanvas" class="radar" width="320" height="320"></canvas>
      <view class="radar-hint">外圈代表该维度满分</view>
    </view>

    <view class="section-title">六维度概览</view>
    <view class="result-list">
      <view wx:for="{{resultList}}" wx:key="key" class="result-item">
        <view class="result-header">
          <view class="result-name-group">
            <text class="result-name">{{item.name}}</text>
            <view wx:if="{{item.isTop}}" class="top-badge">TOP {{item.topRank}}</view>
          </view>
          <view class="result-meta">
            <text class="result-score">{{item.score}}/{{item.total}}</text>
            <text class="result-level">{{item.level}}</text>
          </view>
        </view>
        <text class="result-percent">完成度 {{item.percent}}%</text>
        <view class="energy-bar energy-{{item.levelKey}}">
          <view class="energy-fill" style="width: {{item.percent}}%"></view>
          <text class="energy-percent">{{item.percent}}%</text>
        </view>
        <text class="result-desc">{{item.description}}</text>
      </view>
    </view>

    <view class="top-title">TOP 3 行动能量</view>
    <view class="top-list">
      <view wx:for="{{topDimensions}}" wx:key="key" class="top-item">
        {{item.name}}
      </view>
    </view>

    <view class="section-title">单维度能量画像</view>
    <view class="insight-list">
      <view wx:for="{{topInsights}}" wx:key="key" class="insight-card">
        <view class="insight-header">
          <text class="insight-name">{{item.name}}</text>
          <text class="insight-tag">{{item.shortLabel}}</text>
        </view>
        <text class="insight-core">{{item.coreInsight}}</text>

        <view class="insight-block">
          <text class="insight-label">能量描述</text>
          <view class="insight-items">
            <text wx:for="{{item.energyDescription}}" wx:key="*this" class="insight-item">{{item}}</text>
          </view>
        </view>

        <view class="insight-block">
          <text class="insight-label">支持你的环境</text>
          <view class="insight-items">
            <text wx:for="{{item.supportiveEnvironment}}" wx:key="*this" class="insight-item">{{item}}</text>
          </view>
        </view>

        <view class="insight-block">
          <text class="insight-label">可能消耗你的情境</text>
          <view class="insight-items">
            <text wx:for="{{item.possibleDrain}}" wx:key="*this" class="insight-item">{{item}}</text>
          </view>
        </view>
      </view>
    </view>

    <view class="section-title">三字母组合说明</view>
    <view class="combo-card">
      <view class="combo-code">{{combinationCode}}</view>
      <text wx:for="{{combinationTexts}}" wx:key="*this" class="combo-text">{{item}}</text>
    </view>

    <view class="section-title">使用说明</view>
    <view class="usage-card">
      <text wx:for="{{usageNotes}}" wx:key="*this" class="usage-item">{{item}}</text>
    </view>

    <view class="actions">
      <button class="btn" bindtap="handleRestart">再测一次</button>
    </view>
  </view>

</view>
