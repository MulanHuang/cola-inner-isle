<!--pages/mbti-result/mbti-result.wxml-->
<brand-navbar title="可乐心岛" showBack="{{true}}" bind:ready="onNavReady" />

<view class="container result-container" style="padding-top: {{navBarHeight}}px;">
  <!-- 页面标题 -->
  <view class="page-header fade-in">
    <view class="header-badge">✨ 测试完成</view>
    <view class="header-title">你的性格档案</view>
    <view class="header-line"></view>
  </view>

  <!-- 结果主卡片 - 仪式感设计 -->
  <view class="result-card slide-up">
    <view class="card-glow"></view>
    <view class="result-badge">
      <text class="badge-icon">🎯</text>
      <text class="badge-text">MBTI 类型</text>
    </view>
    <view class="result-type-wrapper">
      <view class="result-type">{{type}}</view>
      <view class="type-underline"></view>
    </view>
    <view class="result-name">{{typeInfo.name}}</view>
    <view class="result-divider"></view>
    <view class="result-desc">{{typeInfo.desc}}</view>
  </view>

  <!-- 个性总结区块 -->
  <view class="summary-card slide-up delay-1">
    <view class="summary-header">
      <text class="summary-icon">💫</text>
      <text class="summary-title">个性速览</text>
    </view>
    <view class="summary-tags">
      <view class="summary-tag tag-{{item.colorType}}" wx:for="{{dimensions}}" wx:key="name">
        <text class="tag-letter">{{item.leftPercent > item.rightPercent ? item.left : item.right}}</text>
        <text class="tag-desc">{{item.leftPercent > item.rightPercent ? item.leftDesc : item.rightDesc}}</text>
      </view>
    </view>
  </view>

  <!-- 维度对比区域 -->
  <view class="dimensions-section slide-up delay-2">
    <view class="section-header">
      <view class="section-icon">📊</view>
      <view class="section-title-wrapper">
        <view class="section-title">四个维度分析</view>
        <view class="section-subtitle">深入了解你的性格倾向</view>
      </view>
    </view>

    <view class="dimensions-list">
      <view
        wx:for="{{dimensions}}"
        wx:key="name"
        class="dimension-card dimension-{{item.colorType}}"
        style="animation-delay: {{index * 100 + 300}}ms">

        <!-- 维度主要结果标题 -->
        <view class="dimension-result-header">
          <text class="result-percent">{{item.leftPercent > item.rightPercent ? item.leftPercent : item.rightPercent}}%</text>
          <text class="result-label">{{item.leftPercent > item.rightPercent ? item.leftDesc : item.rightDesc}}</text>
        </view>

        <!-- 胶囊式进度条 -->
        <view class="capsule-bar-container">
          <view class="capsule-label label-left">
            <text class="label-text">{{item.leftLabel}}</text>
          </view>

          <view class="capsule-bar">
            <view class="capsule-fill-left animate-bar" style="width: {{item.leftPercent}}%"></view>
            <view class="capsule-indicator" style="left: {{item.leftPercent}}%"></view>
            <view class="capsule-fill-right animate-bar" style="width: {{item.rightPercent}}%"></view>
          </view>

          <view class="capsule-label label-right">
            <text class="label-text">{{item.rightLabel}}</text>
          </view>
        </view>

        <!-- 维度说明 -->
        <view class="dimension-hint">
          <text class="hint-text">{{item.hint}}</text>
        </view>
      </view>
    </view>
  </view>

  <!-- 深度解读入口 -->
  <view class="ai-section slide-up delay-3" wx:if="{{aiState === 'idle'}}">
    <view class="ai-card">
      <view class="ai-decoration">
        <view class="ai-circle circle-1"></view>
        <view class="ai-circle circle-2"></view>
        <view class="ai-circle circle-3"></view>
      </view>
      <view class="ai-content">
        <view class="ai-icon">🏝️</view>
        <view class="ai-title">小岛深度解读</view>
        <view class="ai-desc">基于你的测试结果，获取专属性格分析报告</view>
      </view>
      <view class="ai-preview">
        <view class="ai-preview-item">🎯 核心特质总结</view>
        <view class="ai-preview-item">🌊 情绪与能量模式</view>
        <view class="ai-preview-item">🤝 人际关系风格</view>
        <view class="ai-preview-item">🛠️ 工作学习方式</view>
        <view class="ai-preview-item">🌱 成长建议</view>
      </view>
      <button class="ai-btn glow-btn" bindtap="getAiAnalysis">
        <text class="btn-spark">✨</text>
        <text class="btn-text">开始解读</text>
        <view class="btn-shine"></view>
      </button>
      <view class="ai-disclaimer">AI生成，仅供参考</view>
    </view>
  </view>

  <!-- 深度解读加载中 -->
  <view class="analysis-content slide-up" wx:if="{{aiState === 'loading'}}">
    <view class="analysis-header">
      <view class="analysis-icon">🏝️</view>
      <view class="analysis-title">小岛深度解读</view>
      <view class="analysis-badge">生成中</view>
    </view>
    <view class="analysis-body">
      <view class="ai-loading-hint">正在组织你的专属报告...</view>
      <view class="ai-skeleton">
        <view class="ai-skeleton-line"></view>
        <view class="ai-skeleton-line short"></view>
        <view class="ai-skeleton-line"></view>
        <view class="ai-skeleton-line short"></view>
      </view>
    </view>
  </view>

  <!-- 深度解读失败 -->
  <view class="analysis-content slide-up" wx:if="{{aiState === 'error'}}">
    <view class="analysis-header">
      <view class="analysis-icon">🏝️</view>
      <view class="analysis-title">小岛深度解读</view>
      <view class="analysis-badge">暂不可用</view>
    </view>
    <view class="analysis-body">
      <view class="ai-error-title">暂时无法生成解读</view>
      <view class="ai-error-desc">{{analysisError}}</view>
      <view class="analysis-actions">
        <button class="btn-secondary" bindtap="resetAnalysis">
          <text class="btn-icon">↩️</text>
          <text>返回入口</text>
        </button>
        <button class="btn-primary" bindtap="retryAiAnalysis">
          <text class="btn-icon">✨</text>
          <text>再次尝试</text>
        </button>
      </view>
    </view>
  </view>

  <!-- 深度解读内容 -->
  <view class="analysis-content slide-up" wx:if="{{aiState === 'success'}}">
    <view class="analysis-header">
      <view class="analysis-icon">🏝️</view>
      <view class="analysis-title">小岛深度解读</view>
      <view class="analysis-badge">{{analysisStyleLabel}}</view>
    </view>
    <view class="analysis-body">
      <view wx:if="{{analysisSections.length}}" class="analysis-section-list">
        <view class="analysis-section-card" wx:for="{{analysisSections}}" wx:key="key">
          <view class="analysis-section-title">{{item.title}}</view>
          <view class="analysis-section-insight">{{item.insight}}</view>
          <view class="analysis-section-body" wx:if="{{item.body && item.body.length}}">
            <view class="analysis-section-line" wx:for="{{item.body}}" wx:for-item="line" wx:key="*this">
              {{line}}
            </view>
          </view>
          <view class="analysis-section-bullets" wx:if="{{item.bullets && item.bullets.length}}">
            <view class="analysis-section-bullet" wx:for="{{item.bullets}}" wx:for-item="bullet" wx:key="*this">
              • {{bullet}}
            </view>
          </view>
        </view>
      </view>
      <view wx:else class="analysis-text">解读内容为空，请重试。</view>
      <view class="analysis-actions">
        <button class="btn-secondary" bindtap="resetAnalysis">
          <text class="btn-icon">↩️</text>
          <text>返回入口</text>
        </button>
        <button class="btn-primary" bindtap="getAiAnalysis">
          <text class="btn-icon">✨</text>
          <text>再次解读</text>
        </button>
      </view>
    </view>
  </view>

  <!-- 合规免责声明 -->
  <view class="compliance-disclaimer">
    本内容由AI生成，仅供自我探索参考，不构成心理诊断或医疗建议
  </view>

  <!-- 操作按钮区域 -->
  <view class="action-section slide-up delay-4">
    <view class="action-buttons">
      <button class="btn-secondary" bindtap="retakeTest">
        <text class="btn-icon">🔄</text>
        <text>重新测试</text>
      </button>
      <button class="btn-primary" bindtap="goHome">
        <text class="btn-icon">🏠</text>
        <text>返回首页</text>
      </button>
    </view>
  </view>

  <!-- 底部留白 -->
  <view class="footer-space"></view>
</view>
