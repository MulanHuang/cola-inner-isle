<!--pages/chakraResult/index.wxml-->
<view class="container chakra-result-container">
  <!-- å¤´éƒ¨ -->
  <view class="header">
    <view class="header-icon">ğŸŒˆ</view>
    <view class="header-title">è„‰è½®èƒ½é‡åˆ†ææŠ¥å‘Š</view>
    <view class="header-subtitle">æ¢ç´¢ä½ çš„å†…åœ¨èƒ½é‡çŠ¶æ€</view>
  </view>

  <!-- é›·è¾¾å›¾åŒºåŸŸ -->
  <view class="radar-section card">
    <view class="section-title">âœ¨ è„‰è½®èƒ½é‡åˆ†å¸ƒ</view>
    <view class="section-subtitle">ç‚¹å‡»æŸ¥çœ‹å„è„‰è½®è¯¦æƒ…</view>

    <!-- é›·è¾¾å›¾ç»„ä»¶ -->
    <chakra-radar
      id="chakraRadar"
      chakraData="{{radarData}}"
      selectedChakra="{{selectedChakra}}"
      bind:chakrachange="onChakraChange"
    ></chakra-radar>
  </view>

  <!-- é€‰ä¸­è„‰è½®è¯¦æƒ…åˆ†æ -->
  <view class="analysis-section card">
    <view class="analysis-header">
      <view class="analysis-title">
        <text class="analysis-emoji">{{selectedChakraInfo.emoji}}</text>
        <text class="analysis-name">{{selectedChakraInfo.name}}</text>
      </view>
      <view class="analysis-score" style="background: {{selectedChakraInfo.color}}">
        {{selectedChakraInfo.percentage}}%
      </view>
    </view>

    <view class="analysis-status">
      <text class="status-icon">{{selectedChakraInfo.statusIcon}}</text>
      <text class="status-title">{{selectedChakraInfo.statusTitle}}</text>
    </view>

    <view class="analysis-content">
      <!-- çŠ¶æ€æè¿° -->
      <view class="content-block">
        <view class="block-label">ğŸ“ çŠ¶æ€æè¿°</view>
        <text class="block-text" user-select="{{true}}">{{selectedChakraInfo.description}}</text>
      </view>

      <!-- å½“å‰ç‰¹å¾ -->
      <view class="content-block">
        <view class="block-label">ğŸ·ï¸ å½“å‰ç‰¹å¾</view>
        <view class="traits-list">
          <text wx:for="{{selectedChakraInfo.traits}}" wx:key="*this" class="trait-tag" user-select="{{true}}">
            {{item}}
          </text>
        </view>
      </view>

      <!-- å»ºè®®ç»ƒä¹  -->
      <view class="content-block">
        <view class="block-label">ğŸ§˜â€â™€ï¸ å»ºè®®ç»ƒä¹ </view>
        <view class="practice-list">
          <text wx:for="{{selectedChakraInfo.practices}}" wx:key="*this" class="practice-item" user-select="{{true}}">
            â€¢ {{item}}
          </text>
        </view>
      </view>

      <!-- è‚¯å®šè¯­ -->
      <view class="content-block">
        <view class="block-label">ğŸ’« è‚¯å®šè¯­</view>
        <view class="affirmation-text">{{selectedChakraInfo.affirmation}}</view>
      </view>
    </view>
  </view>

  <!-- æ•´ä½“ç»¼åˆåˆ†æåŒºåŸŸ -->
  <view wx:if="{{showOverallSection}}" class="overall-analysis-section">
    <!-- åŠ è½½ä¸­çŠ¶æ€ -->
    <view wx:if="{{isOverallAnalyzing}}" class="overall-loading card">
      <view class="overall-loading-icon">ğŸ”®âœ¨</view>
      <view class="overall-loading-text">æ­£åœ¨ä¸ºä½ ç”Ÿæˆç»¼åˆåˆ†æ...</view>
      <view class="overall-loading-dots">
        <view class="dot"></view>
        <view class="dot"></view>
        <view class="dot"></view>
      </view>
    </view>

    <!-- åˆ†æé”™è¯¯çŠ¶æ€ -->
    <view wx:elif="{{overallAnalysisError}}" class="overall-error card">
      <view class="overall-error-icon">ğŸ˜”</view>
      <view class="overall-error-text">ç»¼åˆåˆ†æåŠ è½½å¤±è´¥</view>
      <view class="overall-error-subtext">è¯·æ£€æŸ¥ç½‘ç»œåé‡è¯•</view>
      <button class="retry-btn" bindtap="retryOverallAnalysis">ğŸ”„ é‡è¯•</button>
    </view>

    <!-- åˆ†æç»“æœ - æ•´ä½“ç»¼åˆåˆ†æ -->
    <view wx:elif="{{overallAnalysis}}" class="overall-result card">
      <view class="overall-header">
        <view class="overall-header-icon">ğŸŒŸâœ¨</view>
        <view class="overall-header-title">æ•´ä½“ç»¼åˆåˆ†æ</view>
      </view>

      <!-- æ•´ä½“èƒ½é‡çŠ¶æ€ -->
      <view class="overall-block">
        <view class="overall-block-label">ğŸŒˆ æ•´ä½“èƒ½é‡çŠ¶æ€</view>
        <text class="overall-block-text" user-select="{{true}}">{{overallAnalysis.overall_state}}</text>
      </view>

      <!-- èƒ½é‡åˆ†å¸ƒç‰¹ç‚¹ -->
      <view class="overall-block">
        <view class="overall-block-label">âš¡ èƒ½é‡åˆ†å¸ƒç‰¹ç‚¹</view>
        <text class="overall-block-text" user-select="{{true}}">{{overallAnalysis.energy_distribution}}</text>
      </view>

      <!-- è„‰è½®é—´çš„è”ç³» -->
      <view class="overall-block">
        <view class="overall-block-label">ğŸ”— è„‰è½®é—´çš„è”ç³»</view>
        <text class="overall-block-text" user-select="{{true}}">{{overallAnalysis.chakra_connections}}</text>
      </view>

      <!-- ä¸ªæ€§åŒ–å»ºè®® -->
      <view wx:if="{{overallAnalysis.personalized_advice && overallAnalysis.personalized_advice.length > 0}}" class="overall-block">
        <view class="overall-block-label">ğŸ’¡ ä¸ªæ€§åŒ–å»ºè®®</view>
        <view class="overall-advice-list">
          <view wx:for="{{overallAnalysis.personalized_advice}}" wx:key="*this" class="overall-advice-item">
            <view class="advice-number">{{index + 1}}</view>
            <text class="advice-text" user-select="{{true}}">{{item}}</text>
          </view>
        </view>
      </view>

      <!-- é‡ç‚¹å…³æ³¨ -->
      <view wx:if="{{overallAnalysis.focus_areas && overallAnalysis.focus_areas.length > 0}}" class="overall-block focus-block">
        <view class="overall-block-label">ğŸ¯ é‡ç‚¹å…³æ³¨</view>
        <view class="focus-list">
          <view wx:for="{{overallAnalysis.focus_areas}}" wx:key="*this" class="focus-item">
            <text user-select="{{true}}">{{item}}</text>
          </view>
        </view>
      </view>

      <!-- æ¸©é¦¨é¼“åŠ± -->
      <view wx:if="{{overallAnalysis.encouragement}}" class="overall-encouragement">
        <view class="encouragement-icon">ğŸ’–</view>
        <text class="encouragement-text" user-select="{{true}}">{{overallAnalysis.encouragement}}</text>
      </view>
    </view>
  </view>

  <!-- AI æ·±åº¦åˆ†æåŒºåŸŸ -->
  <view wx:if="{{showAiSection}}" class="ai-analysis-section">
    <!-- åŠ è½½ä¸­çŠ¶æ€ -->
    <view wx:if="{{isAnalyzing}}" class="ai-loading card">
      <view class="loading-icon">ğŸ¤–</view>
      <view class="loading-text">AI æ­£åœ¨æ·±åº¦åˆ†æä¸­...</view>
      <view class="loading-subtext">è¯·ç¨å€™ç‰‡åˆ»</view>
    </view>

    <!-- åˆ†æé”™è¯¯çŠ¶æ€ -->
    <!-- <view wx:elif="{{analysisError}}" class="ai-error card">
      <view class="error-icon">ğŸ˜”</view>
      <view class="error-text">åˆ†æåŠ è½½å¤±è´¥</view>
      <view class="error-subtext">è¯·æ£€æŸ¥ç½‘ç»œè¿æ¥åé‡è¯•</view>
    </view> -->

    <!-- åˆ†æç»“æœ - æ˜¾ç¤º AI åˆ†æå†…å®¹ -->
    <view wx:elif="{{aiAnalysis}}" class="ai-result">
      <!-- æ€»ä½“æ¦‚è¿° -->
      <view class="ai-summary card">
        <view class="summary-header">
          <view class="summary-icon">ğŸ”®</view>
          <view class="summary-title">AI æ€»ä½“åˆ†æ</view>
        </view>
        <view class="summary-content">{{aiAnalysis.overall_summary}}</view>
      </view>

      <!-- å„è„‰è½®è¯¦ç»†åˆ†æ -->
      <view wx:if="{{aiAnalysis.chakra_details && aiAnalysis.chakra_details.length > 0}}" class="ai-chakra-details">
        <view class="section-title">ğŸ“Š å„è„‰è½®æ·±åº¦è§£è¯»</view>

        <view wx:for="{{aiAnalysis.chakra_details}}" wx:key="name" class="ai-chakra-card card">
          <view class="ai-chakra-header">
            <view class="ai-chakra-title">
              <text class="ai-chakra-name">{{item.name}}</text>
              <text class="ai-chakra-score">{{item.score}}åˆ†</text>
            </view>
            <view class="ai-chakra-status">{{item.status}}</view>
          </view>

          <view class="ai-feelings-section">
            <view class="ai-label">ğŸ’­ ä½ å¯èƒ½æœ‰è¿™äº›æ„Ÿå—</view>
            <text class="ai-feelings-text" user-select="{{true}}">{{item.possible_feelings}}</text>
          </view>

          <view class="ai-suggestions-section">
            <view class="ai-label">ğŸŒ± æ¸©æŸ”çš„å»ºè®®</view>
            <view class="ai-suggestions-list">
              <text wx:for="{{item.suggestions}}" wx:for-item="suggestion" wx:key="*this" class="ai-suggestion-item" user-select="{{true}}">
                â€¢ {{suggestion}}
              </text>
            </view>
          </view>
        </view>
      </view>

      <!-- åº•éƒ¨æ€»ç»“åŒºåŸŸ -->
      <view class="ai-bottom-summary">
        <!-- ä½ çš„èƒ½é‡ä¼˜åŠ¿ -->
        <view wx:if="{{aiAnalysis.strengths && aiAnalysis.strengths.length > 0}}" class="ai-strengths card">
          <view class="bottom-section-title">ğŸ’ª ä½ çš„èƒ½é‡ä¼˜åŠ¿</view>
          <view class="bottom-section-list">
            <view wx:for="{{aiAnalysis.strengths}}" wx:key="*this" class="bottom-section-item">
              {{item}}
            </view>
          </view>
        </view>

        <!-- æˆé•¿å…³æ³¨æ–¹å‘ -->
        <view wx:if="{{aiAnalysis.growth_focus && aiAnalysis.growth_focus.length > 0}}" class="ai-growth card">
          <view class="bottom-section-title">ğŸŒ± æˆé•¿å…³æ³¨æ–¹å‘</view>
          <view class="bottom-section-list">
            <view wx:for="{{aiAnalysis.growth_focus}}" wx:key="*this" class="bottom-section-item">
              {{item}}
            </view>
          </view>
        </view>

        <!-- ç®€å•å°ç»ƒä¹  -->
        <view wx:if="{{aiAnalysis.simple_practices && aiAnalysis.simple_practices.length > 0}}" class="ai-practices card">
          <view class="bottom-section-title">ğŸ§˜â€â™€ï¸ ç®€å•å°ç»ƒä¹ </view>
          <view class="bottom-section-list">
            <view wx:for="{{aiAnalysis.simple_practices}}" wx:key="*this" class="bottom-section-item">
              {{item}}
            </view>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- è„‰è½®æŸ±çŠ¶å›¾ -->
  <view class="chakra-chart card">
    <view class="chart-title">ä¸ƒå¤§è„‰è½®èƒ½é‡å›¾</view>

    <view wx:for="{{chakraList}}" wx:key="type" class="chakra-item">
      <view class="chakra-header">
        <view class="chakra-name">
          <text class="chakra-emoji">{{item.info.emoji}}</text>
          <text class="chakra-name-text">{{item.info.name}}</text>
        </view>
        <view class="chakra-percentage" style="color: {{item.info.color}}">
          {{item.result.percentage}}%
        </view>
      </view>

      <view class="chakra-bar">
        <view
          class="chakra-bar-fill"
          style="width: {{item.result.percentage}}%; background: {{item.info.color}}"
        ></view>
      </view>

      <view class="chakra-keyword">{{item.info.keyword}}</view>
    </view>
  </view>

  <!-- è¯¦ç»†è§£è¯» -->
  <view class="interpretation-section">
    <view class="section-title">ğŸ“– è¯¦ç»†è§£è¯»</view>

    <view wx:for="{{chakraList}}" wx:key="type" class="interpretation-card card">
      <view class="interpretation-header">
        <view class="interpretation-title">
          <text class="chakra-emoji-large">{{item.info.emoji}}</text>
          <view class="title-text">
            <view class="chakra-name-main">{{item.info.name}}</view>
            <view class="chakra-english">{{item.info.englishName}}</view>
          </view>
        </view>
        <view class="interpretation-score" style="background: {{item.info.color}}">
          {{item.result.percentage}}%
        </view>
      </view>

      <view class="interpretation-level">
        <text class="level-icon">{{item.interpretation.percentage >= 80 ? 'âœ¨' : item.interpretation.percentage >= 50 ? 'ğŸŒ±' : 'âš ï¸'}}</text>
        <text class="level-title">{{item.interpretation.title}}</text>
      </view>

      <view class="interpretation-desc">{{item.interpretation.description}}</view>

      <view class="interpretation-traits">
        <view wx:for="{{item.interpretation.traits}}" wx:for-item="trait" wx:key="*this" class="trait-tag">
          {{trait}}
        </view>
      </view>

      <view class="divider"></view>

      <view class="suggestions">
        <view class="suggestion-item">
          <view class="suggestion-label">ğŸ§˜â€â™€ï¸ å†¥æƒ³å»ºè®®</view>
          <view class="suggestion-text">{{item.info.suggestions.meditation}}</view>
        </view>

        <view class="suggestion-item">
          <view class="suggestion-label">ğŸŒ¿ æ—¥å¸¸ç»ƒä¹ </view>
          <view class="practice-list">
            <view wx:for="{{item.info.suggestions.practice}}" wx:for-item="practice" wx:key="*this" class="practice-item">
              â€¢ {{practice}}
            </view>
          </view>
        </view>

        <view class="suggestion-item">
          <view class="suggestion-label">ğŸ’« è‚¯å®šè¯­</view>
          <view class="affirmation-text">{{item.info.suggestions.affirmation}}</view>
        </view>
      </view>
    </view>
  </view>

  <!-- ç»“æŸè¯­ -->
  <view class="closing-card card">
    <view class="closing-icon">ğŸŒ¸</view>
    <view class="closing-text">
      æ„¿ä½ çš„æ¯ä¸€ä¸ªè„‰è½®éƒ½å……æ»¡å…‰èŠ’<br/>
      åœ¨æ¢ç´¢ä¸­é‡è§æ›´å¥½çš„è‡ªå·±
    </view>
  </view>

  <!-- åº•éƒ¨æŒ‰é’® -->
  <view class="button-group">
    <button class="btn-secondary" bindtap="retakeTest">
      ğŸ”„ é‡æ–°æµ‹è¯•
    </button>
    <button class="btn-secondary" bindtap="viewHistory">
      ğŸ“Š å†å²è®°å½•
    </button>
    <button class="btn-primary" bindtap="backToHome">
      ğŸ  è¿”å›é¦–é¡µ
    </button>
  </view>
</view>

