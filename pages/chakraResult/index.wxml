<!--pages/chakraResult/index.wxml-->
<brand-navbar title="å¯ä¹å¿ƒå²›" showBack="{{true}}" bind:ready="onNavReady" />

<view class="container chakra-result-container" style="padding-top: {{navBarHeight}}px;">
  <!-- å¤´éƒ¨ -->
  <view class="header">
    <view class="header-icon">ğŸŒˆ</view>
    <view class="header-title">è„‰è½®èƒ½é‡åˆ†ææŠ¥å‘Š</view>
    <view class="header-subtitle">æ¢ç´¢ä½ çš„å†…åœ¨èƒ½é‡çŠ¶æ€</view>
  </view>

  <!-- é›·è¾¾å›¾åŒºåŸŸ -->
  <view class="radar-section card">
    <view class="section-title">âœ¨ è„‰è½®èƒ½é‡åˆ†å¸ƒ</view>
    <view class="section-subtitle">ç‚¹å‡»æŸ¥çœ‹å„è„‰è½®è¯¦æƒ…</view>

    <!-- é›·è¾¾å›¾ç»„ä»¶ -->
    <chakra-radar
      id="chakraRadar"
      chakraData="{{radarData}}"
      selectedChakra="{{selectedChakra}}"
      bind:chakrachange="onChakraChange"
    ></chakra-radar>
  </view>

  <!-- é€‰ä¸­è„‰è½®è¯¦æƒ…åˆ†æ -->
  <view class="analysis-section card">
    <view class="analysis-header">
      <view class="analysis-title">
        <text class="analysis-emoji">{{selectedChakraInfo.emoji}}</text>
        <text class="analysis-name">{{selectedChakraInfo.name}}</text>
      </view>
      <view class="analysis-score" style="background: {{selectedChakraInfo.color}}">
        {{selectedChakraInfo.percentage}}%
      </view>
    </view>

    <view class="analysis-status">
      <text class="status-icon">{{selectedChakraInfo.statusIcon}}</text>
      <text class="status-title">{{selectedChakraInfo.statusTitle}}</text>
    </view>

    <view class="analysis-content">
      <!-- çŠ¶æ€æè¿° -->
      <view class="content-block">
        <view class="block-label">ğŸ“ çŠ¶æ€æè¿°</view>
        <text class="block-text" user-select="{{true}}">{{selectedChakraInfo.description}}</text>
      </view>

      <!-- å½“å‰ç‰¹å¾ -->
      <view class="content-block">
        <view class="block-label">ğŸ·ï¸ å½“å‰ç‰¹å¾</view>
        <view class="traits-list">
          <text wx:for="{{selectedChakraInfo.traits}}" wx:key="*this" class="trait-tag" user-select="{{true}}">
            {{item}}
          </text>
        </view>
      </view>

      <!-- å»ºè®®ç»ƒä¹  -->
      <view class="content-block">
        <view class="block-label">ğŸ§˜â€â™€ï¸ å»ºè®®ç»ƒä¹ </view>
        <view class="practice-list">
          <text wx:for="{{selectedChakraInfo.practices}}" wx:key="*this" class="practice-item" user-select="{{true}}">
            â€¢ {{item}}
          </text>
        </view>
      </view>

      <!-- è‚¯å®šè¯­ -->
      <view class="content-block">
        <view class="block-label">ğŸ’« è‚¯å®šè¯­</view>
        <view class="affirmation-text">{{selectedChakraInfo.affirmation}}</view>
      </view>
    </view>
  </view>

  <!-- æ·±åº¦åˆ†æåŒºåŸŸ -->
  <view wx:if="{{showAiSection}}" class="ai-analysis-section">
    <!-- æœªå¼€å§‹åˆ†æ - æ˜¾ç¤ºå¼€å§‹æŒ‰é’® -->
    <view wx:if="{{!isAnalyzing && !aiAnalysis && !analysisError}}" class="ai-start card" bindtap="startAiAnalysis">
      <view class="ai-start-icon">âœ¨</view>
      <view class="ai-start-title">å°å²›æ·±åº¦åˆ†æ</view>
      <view class="ai-start-desc">ç‚¹å‡»å¼€å§‹ï¼Œè®©å°å¯ä¸ºä½ è§£è¯»è„‰è½®èƒ½é‡</view>
      <view class="ai-start-btn">å¼€å§‹åˆ†æ</view>
      <view class="ai-disclaimer">æœ¬å†…å®¹ç”±AIç”Ÿæˆï¼Œä»…ä¾›å‚è€ƒ</view>
    </view>

    <!-- åŠ è½½ä¸­çŠ¶æ€ -->
    <view wx:elif="{{isAnalyzing}}" class="ai-loading card">
      <view class="loading-icon">âœ¨</view>
      <view class="loading-text">å°å²›æ­£åœ¨ä¸ºä½ æ·±åº¦åˆ†æ...</view>
      <view class="loading-subtext">è¯·ç¨å€™ç‰‡åˆ»</view>
    </view>

    <!-- åˆ†æé”™è¯¯çŠ¶æ€ -->
    <view wx:elif="{{analysisError}}" class="ai-error card">
      <view class="error-icon">ğŸ˜”</view>
      <view class="error-text">åˆ†æåŠ è½½å¤±è´¥</view>
      <view class="error-subtext">è¯·æ£€æŸ¥ç½‘ç»œè¿æ¥åé‡è¯•</view>
      <button class="retry-btn" bindtap="retryAnalysis">ğŸ”„ é‡è¯•</button>
    </view>

    <!-- åˆ†æç»“æœ - æ˜¾ç¤ºæ·±åº¦åˆ†æå†…å®¹ -->
    <view wx:elif="{{aiAnalysis}}" class="ai-result">
      <!-- æ•´ä½“æ€»ç»“ -->
      <view class="ai-summary card">
        <view class="summary-header">
          <view class="summary-icon">ğŸŒˆ</view>
          <view class="summary-title">æ•´ä½“èƒ½é‡çŠ¶æ€</view>
        </view>
        <text class="summary-content" user-select="{{true}}">{{aiAnalysis.overall_summary}}</text>
      </view>

      <!-- èƒ½é‡æ´å¯Ÿ -->
      <view wx:if="{{aiAnalysis.energy_insight}}" class="ai-insight card">
        <view class="insight-header">
          <view class="insight-icon">âš¡</view>
          <view class="insight-title">èƒ½é‡åˆ†å¸ƒæ´å¯Ÿ</view>
        </view>
        <text class="insight-content" user-select="{{true}}">{{aiAnalysis.energy_insight}}</text>
      </view>

      <!-- åº•éƒ¨æ€»ç»“åŒºåŸŸ -->
      <view class="ai-bottom-summary">
        <!-- ä½ çš„èƒ½é‡ä¼˜åŠ¿ -->
        <view wx:if="{{aiAnalysis.strengths && aiAnalysis.strengths.length > 0}}" class="ai-strengths card">
          <view class="bottom-section-title">ğŸ’ª ä½ çš„èƒ½é‡ä¼˜åŠ¿</view>
          <view class="bottom-section-list">
            <view wx:for="{{aiAnalysis.strengths}}" wx:key="*this" class="bottom-section-item">
              {{item}}
            </view>
          </view>
        </view>

        <!-- æˆé•¿å…³æ³¨æ–¹å‘ -->
        <view wx:if="{{aiAnalysis.growth_focus && aiAnalysis.growth_focus.length > 0}}" class="ai-growth card">
          <view class="bottom-section-title">ğŸŒ± é€‚åˆå…³æ³¨çš„æ–¹å‘</view>
          <view class="bottom-section-list">
            <view wx:for="{{aiAnalysis.growth_focus}}" wx:key="*this" class="bottom-section-item">
              {{item}}
            </view>
          </view>
        </view>

        <!-- æ—¥å¸¸å°ç»ƒä¹  -->
        <view wx:if="{{aiAnalysis.simple_practices && aiAnalysis.simple_practices.length > 0}}" class="ai-practices card">
          <view class="bottom-section-title">ğŸ§˜â€â™€ï¸ æ—¥å¸¸å°ç»ƒä¹ </view>
          <view class="bottom-section-list">
            <view wx:for="{{aiAnalysis.simple_practices}}" wx:key="*this" class="bottom-section-item">
              {{item}}
            </view>
          </view>
        </view>
      </view>

      <!-- æ¸©é¦¨é¼“åŠ± -->
      <view wx:if="{{aiAnalysis.encouragement}}" class="ai-encouragement card">
        <view class="encouragement-icon">ğŸ’–</view>
        <text class="encouragement-text" user-select="{{true}}">{{aiAnalysis.encouragement}}</text>
      </view>
    </view>
  </view>

  <!-- è„‰è½®æŸ±çŠ¶å›¾ -->
  <view class="chakra-chart card">
    <view class="chart-title">ä¸ƒå¤§è„‰è½®èƒ½é‡å›¾</view>

    <view wx:for="{{chakraList}}" wx:key="type" class="chakra-item">
      <view class="chakra-header">
        <view class="chakra-name">
          <text class="chakra-emoji">{{item.info.emoji}}</text>
          <text class="chakra-name-text">{{item.info.name}}</text>
        </view>
        <view class="chakra-percentage" style="color: {{item.info.color}}">
          {{item.result.percentage}}%
        </view>
      </view>

      <view class="chakra-bar">
        <view
          class="chakra-bar-fill"
          style="width: {{item.result.percentage}}%; background: {{item.info.color}}"
        ></view>
      </view>

      <view class="chakra-keyword">{{item.info.keyword}}</view>
    </view>
  </view>

  <!-- è¯¦ç»†è§£è¯» -->
  <view class="interpretation-section">
    <view class="section-title">ğŸ“– è¯¦ç»†è§£è¯»</view>

    <view wx:for="{{chakraList}}" wx:key="type" class="interpretation-card card">
      <view class="interpretation-header">
        <view class="interpretation-title">
          <text class="chakra-emoji-large">{{item.info.emoji}}</text>
          <view class="title-text">
            <view class="chakra-name-main">{{item.info.name}}</view>
            <view class="chakra-english">{{item.info.englishName}}</view>
          </view>
        </view>
        <view class="interpretation-score" style="background: {{item.info.color}}">
          {{item.result.percentage}}%
        </view>
      </view>

      <view class="interpretation-level">
        <text class="level-icon">{{item.interpretation.percentage >= 80 ? 'âœ¨' : item.interpretation.percentage >= 50 ? 'ğŸŒ±' : 'âš ï¸'}}</text>
        <text class="level-title">{{item.interpretation.title}}</text>
      </view>

      <view class="interpretation-desc">{{item.interpretation.description}}</view>

      <view class="interpretation-traits">
        <view wx:for="{{item.interpretation.traits}}" wx:for-item="trait" wx:key="*this" class="trait-tag">
          {{trait}}
        </view>
      </view>

      <view class="divider"></view>

      <view class="suggestions">
        <view class="suggestion-item">
          <view class="suggestion-label">ğŸ§˜â€â™€ï¸ å†¥æƒ³å»ºè®®</view>
          <view class="suggestion-text">{{item.info.suggestions.meditation}}</view>
        </view>

        <view class="suggestion-item">
          <view class="suggestion-label">ğŸŒ¿ æ—¥å¸¸ç»ƒä¹ </view>
          <view class="practice-list">
            <view wx:for="{{item.info.suggestions.practice}}" wx:for-item="practice" wx:key="*this" class="practice-item">
              â€¢ {{practice}}
            </view>
          </view>
        </view>

        <view class="suggestion-item">
          <view class="suggestion-label">ğŸ’« è‚¯å®šè¯­</view>
          <view class="affirmation-text">{{item.info.suggestions.affirmation}}</view>
        </view>
      </view>
    </view>
  </view>

  <!-- ç»“æŸè¯­ -->
  <view class="closing-card card">
    <view class="closing-icon">ğŸŒ¸</view>
    <view class="closing-text">
      æ„¿ä½ çš„æ¯ä¸€ä¸ªè„‰è½®éƒ½å……æ»¡å…‰èŠ’<br/>
      åœ¨æ¢ç´¢ä¸­é‡è§æ›´å¥½çš„è‡ªå·±
    </view>
  </view>

  <!-- åº•éƒ¨æŒ‰é’® -->
  <view class="button-group">
    <button class="btn-secondary" bindtap="retakeTest">
       é‡æ–°æµ‹è¯•
    </button>
    <button class="btn-secondary" bindtap="viewHistory">
      å†å²è®°å½•
    </button>
    <button class="btn-primary" bindtap="backToHome">
      è¿”å›é¦–é¡µ
    </button>
  </view>
</view>

