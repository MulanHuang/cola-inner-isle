<!--pages/habitCalendar/habitCalendar.wxml-->
<!-- è‡ªå®šä¹‰å¯¼èˆªæ  -->
<view class="custom-navbar" style="padding-top: {{statusBarHeight}}px;">
  <view class="navbar-content">
    <view class="navbar-back" bindtap="goBack">
      <image class="back-icon" src="/assets/icons/chevron-left.svg" mode="aspectFit" />
    </view>
    <view class="navbar-title">æˆ‘çš„ç»ƒä¹ </view>
    <view class="navbar-placeholder"></view>
  </view>
</view>

<view class="page-container" style="padding-top: {{navBarHeight}}px;">
  <!-- Tab Pills -->
  <view class="tab-pills">
    <view class="tab-pill {{currentTab === 'day' ? 'active' : ''}}" bindtap="switchView" data-tab="day">æ—¥è§†å›¾</view>
    <view class="tab-pill {{currentTab === 'week' ? 'active' : ''}}" bindtap="switchView" data-tab="week">å‘¨è§†å›¾</view>
    <view class="tab-pill {{currentTab === 'month' ? 'active' : ''}}" bindtap="switchView" data-tab="month">æœˆè§†å›¾</view>
  </view>

  <!-- ========== æ—¥è§†å›¾ Day View ========== -->
  <view class="view-content day-view" wx:if="{{currentTab === 'day'}}">
    <!-- é¡¶éƒ¨æ—¥æœŸå¡ç‰‡ -->
    <view class="day-date-card">
      <view class="day-date-left">
        <text class="day-date-text">{{dayData.dateDisplay}}</text>
        <text class="day-date-hint">ä»Šå¤©ç»™è‡ªå·±ä¸€ç‚¹æ¸©æŸ”çš„åšæŒ ğŸ’›</text>
      </view>
      <view class="day-status-tag {{dayData.statusType}}">
        <text>{{dayData.statusLabel}}</text>
      </view>
    </view>

    <!-- ä»Šæ—¥ç»ƒä¹ æ¸…å• -->
    <view class="day-checklist-card">
      <view class="card-title">ä»Šæ—¥ç»ƒä¹ æ¸…å•</view>
      <view class="day-habits-list">
        <view class="day-habit-item"
              wx:for="{{dayData.habits}}"
              wx:key="key"
              bindtap="onHabitTap"
              data-key="{{item.key}}"
              data-status="{{item.status}}"
              data-url="{{item.url}}"
              data-is-tab="{{item.isTab}}"
              data-name="{{item.name}}">
          <view class="habit-item-left">
            <text class="habit-emoji">{{item.emoji}}</text>
            <text class="habit-name">{{item.name}}</text>
          </view>
          <view class="habit-item-right">
            <view wx:if="{{item.status === 'done'}}" class="habit-status done">
              <view class="status-dot-filled"></view>
              <text class="status-text">å·²ç»ƒä¹ </text>
            </view>
            <view wx:elif="{{item.status === 'undone'}}" class="habit-status undone">
              <view class="status-dot-empty"></view>
              <text class="status-text go">å»å®Œæˆ</text>
            </view>
            <view wx:else class="habit-status na">
              <text class="status-text">-</text>
            </view>
          </view>
        </view>
      </view>
    </view>

    <!-- åº•éƒ¨ä»Šæ—¥ä¸€å¥ -->
    <view class="day-summary-card">
      <text class="summary-text">{{dayData.summary}}</text>
    </view>
  </view>

  <!-- ========== å‘¨è§†å›¾ Week View ========== -->
  <view class="view-content week-view" wx:if="{{currentTab === 'week'}}">
    <!-- é¡¶éƒ¨æ ‡é¢˜åŒº -->
    <view class="week-header-card">
      <text class="week-title">{{weekData.title}}</text>
      <text class="week-subtitle">{{weekData.subtitle}}</text>
    </view>

    <!-- å‘¨çŸ©é˜µè¡¨æ ¼ -->
    <view class="week-matrix-card">
      <!-- è¡¨å¤´ï¼šæ˜ŸæœŸ -->
      <view class="week-table-header">
        <view class="week-label-cell"></view>
        <view class="week-days-row">
          <text class="week-day-label" wx:for="{{weekData.weekDays}}" wx:key="*this">{{item}}</text>
        </view>
        <view class="week-count-cell">æ¬¡æ•°</view>
      </view>

      <!-- çƒ­åº¦æ¡ -->
      <view class="week-heat-row">
        <view class="week-label-cell"></view>
        <view class="week-days-row">
          <view class="heat-bar-wrapper" wx:for="{{weekData.dailyCompletedCounts}}" wx:key="index">
            <view class="heat-bar" style="height: {{item * 8}}rpx;"></view>
          </view>
        </view>
        <view class="week-count-cell"></view>
      </view>

      <!-- ä¹ æƒ¯è¡Œ -->
      <view class="week-habit-row" wx:for="{{weekData.habits}}" wx:key="name">
        <view class="week-label-cell">
          <text class="week-habit-emoji">{{item.emoji}}</text>
          <text class="week-habit-name">{{item.name}}</text>
        </view>
        <view class="week-days-row">
          <view class="week-dot-wrapper" wx:for="{{item.days}}" wx:for-item="dayStatus" wx:key="index">
            <view wx:if="{{dayStatus === 'done'}}" class="week-dot done"></view>
            <view wx:elif="{{dayStatus === 'undone'}}" class="week-dot undone"></view>
            <view wx:else class="week-dot na"></view>
          </view>
        </view>
        <view class="week-count-cell">
          <text class="week-count">Â· {{item.weekCount}}æ¬¡</text>
        </view>
      </view>
    </view>

    <!-- åº•éƒ¨ç»Ÿè®¡å¡ç‰‡ -->
    <view class="week-stats-card">
      <view class="stats-row">
        <view class="stat-block completion">
          <text class="stat-label">æœ¬å‘¨å®Œæˆç‡</text>
          <view class="progress-bar-wrapper">
            <view class="progress-bar-bg">
              <view class="progress-bar-fill" style="width: {{weekData.stats.completionPercent}}%;"></view>
            </view>
            <text class="progress-text">{{weekData.stats.completionRate}}</text>
          </view>
        </view>
        <view class="stat-block streak">
          <text class="stat-label">è¿ç»­ç»ƒä¹ </text>
          <text class="stat-value">{{weekData.stats.streak}} å¤©</text>
        </view>
      </view>
      <view class="best-day-banner">
        <text class="best-day-text">{{weekData.stats.bestDayText}}</text>
      </view>
    </view>
  </view>

  <!-- ========== æœˆè§†å›¾ Month View ========== -->
  <view class="view-content month-view" wx:if="{{currentTab === 'month'}}">
    <!-- é¡¶éƒ¨æ ‡é¢˜åŒº -->
    <view class="month-header-card">
      <text class="month-title">{{monthData.title}}</text>
      <text class="month-subtitle">{{monthData.subtitle}}</text>
    </view>

    <!-- æ—¥å†ç½‘æ ¼ -->
    <view class="month-calendar-card">
      <!-- æ˜ŸæœŸè¡¨å¤´ -->
      <view class="month-weekdays-row">
        <text class="month-weekday" wx:for="{{monthData.weekDays}}" wx:key="*this">{{item}}</text>
      </view>

      <!-- æ—¥æœŸç½‘æ ¼ -->
      <view class="month-days-grid">
        <view class="month-day-cell {{item.status}} {{monthData.selectedDay === item.day ? 'selected' : ''}} heat-{{item.heatLevel}}"
              wx:for="{{monthData.days}}"
              wx:key="index"
              bindtap="onMonthDayTap"
              data-day="{{item.day}}"
              data-date-str="{{item.dateStr}}"
              data-completed-count="{{item.completedCount}}"
              data-completed-habits="{{item.completedHabits}}"
              data-status="{{item.status}}">
          <text wx:if="{{item.day}}" class="day-num">{{item.day}}</text>
          <view wx:if="{{item.heatLevel > 0}}" class="heat-dot heat-{{item.heatLevel}}"></view>
        </view>
      </view>
    </view>

    <!-- é€‰ä¸­æ—¥æœŸæ‘˜è¦ -->
    <view class="month-day-summary" wx:if="{{monthData.selectedDaySummary}}">
      <view class="summary-content">
        <text class="summary-text">{{monthData.selectedDaySummary}}</text>
        <view class="summary-action" bindtap="viewSelectedDayDetail">
          <text>æŸ¥çœ‹è¯¦æƒ…</text>
          <text class="arrow">></text>
        </view>
      </view>
    </view>

    <!-- åº•éƒ¨ç»Ÿè®¡ -->
    <view class="month-stats-card">
      <view class="month-stats-row">
        <view class="month-stat-item">
          <text class="stat-value">{{monthData.stats.totalCompleted}}</text>
          <text class="stat-label">æœˆæ€»å®Œæˆ</text>
        </view>
        <view class="month-stat-item">
          <text class="stat-value">{{monthData.stats.avgPerDay}}</text>
          <text class="stat-label">æ—¥å‡æ¬¡æ•°</text>
        </view>
        <view class="month-stat-item">
          <text class="stat-value">{{monthData.stats.bestStreak}}</text>
          <text class="stat-label">æœ€ä½³è¿ç»­</text>
        </view>
      </view>
      <view class="month-summary-banner">
        <text class="summary-banner-text">{{monthData.stats.summaryText}}</text>
      </view>
    </view>
  </view>
</view>

<!-- åº•éƒ¨å®‰å…¨åŒºåŸŸ -->
<view class="safe-area-bottom"></view>
