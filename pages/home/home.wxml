<!--pages/home/home.wxml-->
<!-- è‡ªå®šä¹‰å¯¼èˆªæ  -->
<brand-navbar bind:ready="onNavReady" />

<view class="home-container page-with-custom-navbar" style="padding-top: {{navBarHeight}}px;">
  <!-- ä»Šæ—¥ä¸€å¥ -->
  <view class="card quote-card">
    <view class="quote-icon">âœ¨</view>
    <text class="quote-text" user-select="{{true}}">{{dailyQuote.content}}</text>
    <text class="quote-author" wx:if="{{dailyQuote.author}}" user-select="{{true}}">â€” {{dailyQuote.author}}</text>
    <view class="quote-refresh pressable" hover-class="pressable-active" hover-stay-time="80" bindtap="refreshQuote">
      <image class="refresh-icon" src="/assets/icons/refresh-outline.svg" mode="aspectFit" />
      <text class="refresh-text">æ¢ä¸€å¥</text>
    </view>
  </view>

  <!-- æ¯æ—¥å¡”ç½—ç‰Œ -->
  <view class="card tarot-card pressable" hover-class="pressable-active" hover-stay-time="80" bindtap="goToTarot">
    <view class="tarot-header">
      <view class="tarot-title-chip">
        <text class="tarot-title-icon">ğŸ”®</text>
        <text class="tarot-title-text">æ¯æ—¥å¡”ç½—</text>
      </view>
      <view class="tarot-status">
        <view class="tarot-status-dot {{tarotStatus === 'å·²æŠ½å–' ? 'is-done' : ''}}"></view>
        <text class="tarot-status-text">{{tarotStatus}}</text>
      </view>
    </view>
    <view class="tarot-content">
      <view wx:if="{{!todayTarot}}" class="tarot-undrawn">
        <image class="tarot-card-back" src="{{tarotCardBackUrl}}" mode="aspectFit"></image>
        <view class="tarot-hint">ç‚¹å‡»æŠ½å–ä»Šæ—¥å¡”ç½—ç‰Œ</view>
      </view>
      <view wx:else class="tarot-drawn">
        <image class="tarot-card-front" src="{{todayTarot.image}}" mode="aspectFit"></image>
        <view class="tarot-name">{{todayTarot.name}}</view>
        <view class="tarot-actions">
          <view class="tarot-hint">å·²æŠ½å–ï¼Œç‚¹æ­¤é‡æ–°æŠ½å–æˆ–æŸ¥çœ‹</view>
          <button class="tarot-redo-btn" size="mini" catchtap="redoTarot" hover-class="tarot-redo-hover" hover-stay-time="60">é‡æ–°æŠ½å–</button>
        </view>
      </view>
    </view>
  </view>

  <!-- æ¢ç´¢å·¥å…·Â·æ¯æ—¥ç»ƒä¹  Mini æ‰“å¡æ—¥å† -->
  <view class="habit-card pressable" hover-class="pressable-active" hover-stay-time="80" bindtap="goToHabitCalendar">
    <!-- é¡¶éƒ¨æ ‡é¢˜è¡Œ -->
    <view class="habit-header">
      <view class="habit-title-section">
        <view class="habit-title">æ¢ç´¢å·¥å…· Â· æ¯æ—¥ç»ƒä¹ </view>
      </view>
      <view class="habit-arrow" hover-class="habit-arrow-hover">
        <image class="habit-arrow-icon" src="/assets/icons/chevron-right.svg" mode="aspectFit" />
      </view>
    </view>

    <!-- æ‰“å¡ç‚¹é˜µåŒºåŸŸ -->
    <view class="habit-grid">
      <!-- æ˜ŸæœŸè¡¨å¤´è¡Œ -->
      <view class="habit-week-header">
        <view class="habit-row-left-placeholder"></view>
        <view class="habit-week-labels">
          <text class="week-label {{todayWeekIndex === 0 ? 'today' : ''}}">M</text>
          <text class="week-label {{todayWeekIndex === 1 ? 'today' : ''}}">T</text>
          <text class="week-label {{todayWeekIndex === 2 ? 'today' : ''}}">W</text>
          <text class="week-label {{todayWeekIndex === 3 ? 'today' : ''}}">T</text>
          <text class="week-label {{todayWeekIndex === 4 ? 'today' : ''}}">F</text>
          <text class="week-label {{todayWeekIndex === 5 ? 'today' : ''}}">S</text>
          <text class="week-label {{todayWeekIndex === 6 ? 'today' : ''}}">S</text>
        </view>
      </view>

      <!-- å¡”ç½—è¡Œ -->
      <view class="habit-row">
        <view class="habit-row-left">
          <image class="habit-icon" src="/assets/icons/habit-tarot.svg" mode="aspectFit" />
          <text class="habit-name">å¡”ç½—</text>
        </view>
        <view class="habit-dots">
          <view wx:for="{{weekHabitData.tarot}}" wx:key="index"
                class="habit-dot {{item ? 'completed' : 'incomplete'}} {{todayWeekIndex === index ? 'today-col' : ''}}"
                data-date="{{weekDates[index]}}"
                catchtap="handleCalendarDayTap"></view>
        </view>
      </view>

      <!-- åˆ†éš”çº¿ -->
      <view class="habit-divider"></view>

      <!-- å†¥æƒ³è¡Œ -->
      <view class="habit-row">
        <view class="habit-row-left">
          <image class="habit-icon" src="/assets/icons/habit-meditation.svg" mode="aspectFit" />
          <text class="habit-name">å†¥æƒ³</text>
        </view>
        <view class="habit-dots">
          <view wx:for="{{weekHabitData.meditation}}" wx:key="index"
                class="habit-dot {{item ? 'completed' : 'incomplete'}} {{todayWeekIndex === index ? 'today-col' : ''}}"
                data-date="{{weekDates[index]}}"
                catchtap="handleCalendarDayTap"></view>
        </view>
      </view>

      <!-- åˆ†éš”çº¿ -->
      <view class="habit-divider"></view>

      <!-- æƒ…ç»ªè¡Œ -->
      <view class="habit-row">
        <view class="habit-row-left">
          <image class="habit-icon" src="/assets/icons/habit-emotion.svg" mode="aspectFit" />
          <text class="habit-name">æƒ…ç»ª</text>
        </view>
        <view class="habit-dots">
          <view wx:for="{{weekHabitData.emotion}}" wx:key="index"
                class="habit-dot {{item ? 'completed' : 'incomplete'}} {{todayWeekIndex === index ? 'today-col' : ''}}"
                data-date="{{weekDates[index]}}"
                catchtap="handleCalendarDayTap"></view>
        </view>
      </view>
    </view>

    <!-- åº•éƒ¨åšæŒæç¤ºæ–‡æ¡ˆ -->
    <view class="habit-encourage-text">åšæŒæ˜¯ä¸€ä»¶äº†ä¸èµ·çš„äº‹ âœ¨</view>
  </view>

  <!-- è‡ªæˆ‘æ¢ç´¢å…¥å£ -->
  <view class="card explore-card">
    <view class="explore-header">
      <view class="explore-title">ğŸŒ± è‡ªæˆ‘æ¢ç´¢</view>
      <view class="explore-arrow pressable" hover-class="pressable-active" hover-stay-time="80" bindtap="goToExplore">â†’</view>
    </view>
    <view class="explore-items">
      <view class="explore-tag pressable" hover-class="pressable-active" hover-stay-time="80" bindtap="goToOhCard">OHå¡</view>
      <view class="explore-tag pressable" hover-class="pressable-active" hover-stay-time="80" bindtap="goToAromaCard">ğŸŒ¿ èŠ³é¦™æƒ…ç»ªå¡</view>
      <view class="explore-tag pressable" hover-class="pressable-active" hover-stay-time="80" bindtap="goToEmotion">
        <image class="explore-tag-icon" src="/assets/icons/heart-outline.svg" mode="aspectFit" />
        <text>æƒ…ç»ªè®°å½•</text>
      </view>
      <view class="explore-tag pressable" hover-class="pressable-active" hover-stay-time="80" bindtap="goToDreamGrid">æ¢¦æƒ³ä¹å®«æ ¼</view>
      <view class="explore-tag pressable" hover-class="pressable-active" hover-stay-time="80" bindtap="goToChakraTest">è„‰è½®æµ‹è¯•</view>
      <view class="explore-tag pressable" hover-class="pressable-active" hover-stay-time="80" bindtap="goToMBTI">MBTI</view>
      <view class="explore-tag pressable" hover-class="pressable-active" hover-stay-time="80" bindtap="goToZodiac">æ˜Ÿåº§</view>
    </view>
  </view>
</view>

<!-- å…¨å±€æ‚¬æµ®éŸ³ä¹æ§åˆ¶æŒ‰é’® -->
<audio-float />

<!-- å½“æ—¥å®Œæˆæƒ…å†µå¼¹çª— -->
<view class="day-detail-popup" wx:if="{{showDayDetailPopup}}">
  <!-- åŠé€æ˜é®ç½©å±‚ -->
  <view class="popup-mask" bindtap="closeDayDetailPopup"></view>

  <!-- åº•éƒ¨å¼¹å‡ºå¡ç‰‡ -->
  <view class="popup-card">
    <!-- æ ‡é¢˜åŒºåŸŸ -->
    <view class="popup-header">
      <view class="popup-title">{{selectedDateDisplay}} çš„æ‰“å¡æƒ…å†µ</view>
      <view class="popup-close" bindtap="closeDayDetailPopup">âœ•</view>
    </view>

    <!-- æ­£æ–‡åŒºåŸŸ -->
    <view class="popup-content">
      <!-- æ— è®°å½•çŠ¶æ€ -->
      <view wx:if="{{!selectedDayDetail.hasAnyRecord}}" class="popup-empty">
        <text class="empty-icon">ğŸ“</text>
        <text class="empty-text">å½“å¤©æ— æ‰“å¡è®°å½•</text>
        <text class="empty-hint">è¯•è¯•å¼€å§‹ä¸€é¡¹å°å°çš„åšæŒå§~</text>
      </view>

      <!-- æœ‰è®°å½•çŠ¶æ€ -->
      <view wx:else class="popup-habits">
        <!-- å¡”ç½— -->
        <view class="popup-habit-item">
          <view class="habit-info">
            <text class="habit-emoji">ğŸ”®</text>
            <text class="habit-label">å¡”ç½—</text>
          </view>
          <view class="habit-status {{selectedDayDetail.hasTarot ? 'done' : 'undone'}}">
            <text>{{selectedDayDetail.hasTarot ? 'å·²å®Œæˆ' : 'æœªå®Œæˆ'}}</text>
            <text wx:if="{{selectedDayDetail.tarotCount > 0}}" class="habit-count">{{selectedDayDetail.tarotCount}}æ¬¡</text>
          </view>
        </view>

        <!-- å†¥æƒ³ -->
        <view class="popup-habit-item">
          <view class="habit-info">
            <text class="habit-emoji">ğŸ§˜</text>
            <text class="habit-label">å†¥æƒ³</text>
          </view>
          <view class="habit-status {{selectedDayDetail.hasMeditation ? 'done' : 'undone'}}">
            <text>{{selectedDayDetail.hasMeditation ? 'å·²å®Œæˆ' : 'æœªå®Œæˆ'}}</text>
            <text wx:if="{{selectedDayDetail.meditationCount > 0}}" class="habit-count">{{selectedDayDetail.meditationCount}}æ¬¡</text>
          </view>
        </view>

        <!-- æƒ…ç»ª -->
        <view class="popup-habit-item">
          <view class="habit-info">
            <text class="habit-emoji">ğŸ’›</text>
            <text class="habit-label">æƒ…ç»ª</text>
          </view>
          <view class="habit-status {{selectedDayDetail.hasEmotion ? 'done' : 'undone'}}">
            <text>{{selectedDayDetail.hasEmotion ? 'å·²å®Œæˆ' : 'æœªå®Œæˆ'}}</text>
            <text wx:if="{{selectedDayDetail.emotionCount > 0}}" class="habit-count">{{selectedDayDetail.emotionCount}}æ¬¡</text>
          </view>
        </view>
      </view>
    </view>

    <!-- åº•éƒ¨æŒ‰é’® -->
    <view class="popup-footer">
      <button class="popup-btn" bindtap="closeDayDetailPopup">æˆ‘çŸ¥é“äº†</button>
    </view>
  </view>
</view>

<!-- ä¸ªäººæ¡£æ¡ˆå¼•å¯¼å¼¹çª— -->
<view class="profile-prompt-popup" wx:if="{{showProfilePrompt}}">
  <!-- åŠé€æ˜é®ç½©å±‚ -->
  <view class="popup-mask" bindtap="closeProfilePrompt"></view>

  <!-- å¼¹çª—å¡ç‰‡ -->
  <view class="profile-prompt-card">
    <!-- é¡¶éƒ¨è£…é¥°å›¾æ ‡ -->
    <view class="profile-prompt-icon">ğŸŒŸ</view>

    <!-- æ ‡é¢˜ -->
    <view class="profile-prompt-title">å®Œå–„ä½ çš„ä¸“å±æ¡£æ¡ˆ</view>

    <!-- æè¿°æ–‡å­— -->
    <view class="profile-prompt-desc">
      å¡«å†™ä¸ªäººä¿¡æ¯ï¼Œè·å¾—æ›´å‡†ç¡®çš„æ˜Ÿåº§ã€å¡”ç½—è§£è¯»å“¦ï½
    </view>

    <!-- å¥½å¤„åˆ—è¡¨ -->
    <view class="profile-prompt-benefits">
      <view class="benefit-item">
        <text class="benefit-icon">ğŸ”®</text>
        <text class="benefit-text">å¡”ç½—è§£è¯»æ›´ç²¾å‡†</text>
      </view>
      <view class="benefit-item">
        <text class="benefit-icon">â­</text>
        <text class="benefit-text">æ˜Ÿåº§ç‰¹è´¨æ›´è´´åˆ</text>
      </view>
      <view class="benefit-item">
        <text class="benefit-icon">ğŸ’«</text>
        <text class="benefit-text">å¿ƒè¯­æ›´æ‡‚ä½ </text>
      </view>
    </view>

    <!-- æŒ‰é’®ç»„ -->
    <view class="profile-prompt-buttons">
      <button class="profile-prompt-btn primary" bindtap="goToProfileInfo">ç«‹å³å®Œå–„</button>
      <button class="profile-prompt-btn secondary" bindtap="closeProfilePrompt">ç¨åå†è¯´</button>
    </view>
  </view>
</view>
