<!--pages/meditation/player/player.wxml-->
<view class="container player-container">
  <!-- èƒŒæ™¯ -->
  <view class="player-bg" style="background-image: url({{audio.cover}})"></view>
  <view class="player-overlay"></view>

  <!-- å†…å®¹ -->
  <view class="player-content">
    <!-- å°é¢ -->
    <view class="cover-wrapper">
      <image class="cover-image {{playing ? 'rotating' : ''}}" src="{{audio.cover}}" mode="aspectFill"></image>
    </view>

    <!-- éŸ³é¢‘ä¿¡æ¯ -->
    <view class="audio-info">
      <view class="audio-title">{{audio.title}}</view>
      <text class="audio-desc" user-select="{{true}}">{{audio.description}}</text>
    </view>

    <!-- ========== ä¸‹åŠéƒ¨åˆ†ï¼šæ——èˆ°çº§å†¥æƒ³æ’­æ”¾å™¨ UI ========== -->
    <view class="bottom-section">
      <!-- æŸ”å…‰èƒŒæ™¯å±‚ -->
      <view class="bottom-glow"></view>

      <!-- è¿›åº¦æ¡åŒºåŸŸ - Apple Music é£æ ¼ -->
      <view class="progress-section">
        <text class="progress-time time-left">{{currentTimeStr}}</text>
        <view class="progress-track">
          <slider
            class="progress-slider"
            value="{{progress}}"
            min="0"
            max="100"
            block-size="18"
            backgroundColor="rgba(255,255,255,0.2)"
            activeColor="rgba(255,255,255,0.8)"
            bindchange="onProgressChange"
          />
        </view>
        <text class="progress-time time-right">{{durationStr}}</text>
      </view>

      <!-- ä¸»æ’­æ”¾æ§åˆ¶åŒº - ä¸‰ä¸ªåœ†å½¢æŒ‰é’® -->
      <view class="play-controls">
        <!-- ä¸Šä¸€æ®µ / åé€€ -->
        <view class="ctrl-btn ctrl-btn-side" bindtap="seekBackward">
          <image class="ctrl-icon" src="/images/icons/skip-back.svg" mode="aspectFit"></image>
        </view>
        <!-- æ’­æ”¾ / æš‚åœï¼ˆä¸»æŒ‰é’®ï¼‰-->
        <view class="ctrl-btn ctrl-btn-main {{audioBuffering ? 'buffering' : ''}}" bindtap="togglePlay">
          <view class="main-btn-glow"></view>
          <!-- ğŸš€ ç¼“å†²åŠ è½½åŠ¨ç”» -->
          <view wx:if="{{audioBuffering}}" class="buffering-spinner">
            <view class="spinner-ring"></view>
          </view>
          <!-- æ’­æ”¾/æš‚åœå›¾æ ‡ -->
          <image wx:else class="ctrl-icon ctrl-icon-main {{playing ? '' : 'play-icon'}}" src="{{playing ? '/images/icons/pause.svg' : '/images/icons/play.svg'}}" mode="aspectFit"></image>
        </view>
        <!-- ä¸‹ä¸€æ®µ / å‰è¿› -->
        <view class="ctrl-btn ctrl-btn-side" bindtap="seekForward">
          <image class="ctrl-icon" src="/images/icons/skip-forward.svg" mode="aspectFit"></image>
        </view>
      </view>

      <!-- åŠŸèƒ½æ§åˆ¶åŒº - ç»Ÿä¸€ Toolbar -->
      <view class="func-toolbar">
        <!-- å®šæ—¶ -->
        <view class="func-item {{sleepTimer > 0 ? 'active' : ''}}" bindtap="showSleepTimerPicker">
          <image class="func-icon" src="/images/icons/clock.svg" mode="aspectFit"></image>
          <text class="func-label">{{sleepTimer > 0 ? sleepTimerStr : 'å®šæ—¶'}}</text>
        </view>
        <!-- å¾ªç¯ -->
        <view class="func-item {{loopMode ? 'active' : ''}}" bindtap="toggleLoop">
          <image class="func-icon" src="/images/icons/repeat.svg" mode="aspectFit"></image>
          <text class="func-label">å¾ªç¯</text>
        </view>
        <!-- å€é€Ÿ -->
        <view class="func-item {{speed !== 1.0 ? 'active' : ''}}" bindtap="showSpeedPicker">
          <image class="func-icon" src="/images/icons/zap.svg" mode="aspectFit"></image>
          <text class="func-label">{{speed}}x</text>
        </view>
      </view>
    </view>

    <!-- åº•éƒ¨å®‰å…¨åŒºåŸŸ -->
    <view class="safe-bottom"></view>
  </view>

  <!-- ========== å®šæ—¶å…³é—­å¼¹çª— - ç²‰è‰²æ²»æ„ˆç³»é£æ ¼ ========== -->
  <view class="timer-modal {{timerPanelVisible ? 'visible' : ''}}" catchtouchmove="preventTouchMove">
    <!-- é®ç½©å±‚ - æŸ”å’Œç²‰è‰² -->
    <view class="timer-mask" bindtap="hideTimerPanel"></view>

    <!-- åº•éƒ¨é¢æ¿ - æµ…ç²‰æ¯›ç»ç’ƒ -->
    <view class="timer-panel" catchtap="stopPropagation">
      <!-- æ‹–æ‹½æŒ‡ç¤ºæ¡ -->
      <view class="panel-handle"></view>

      <!-- æ ‡é¢˜åŒº -->
      <view class="panel-header">
        <text class="panel-title">å®šæ—¶å…³é—­</text>
        <text class="panel-subtitle">é€‰æ‹©è‡ªåŠ¨åœæ­¢æ’­æ”¾çš„æ—¶é—´</text>
      </view>

      <!-- å®šæ—¶é€‰é¡¹åŒº - æŸ”å…‰èƒ¶å›Šæ¡ -->
      <view class="timer-capsule">
        <scroll-view
          class="timer-scroll"
          scroll-x="{{true}}"
          enhanced="{{true}}"
          show-scrollbar="{{false}}"
          scroll-into-view="timer-opt-{{selectedTimerIndex}}"
          scroll-with-animation="{{true}}"
        >
          <view class="timer-options">
            <block wx:for="{{timerOptions}}" wx:key="index">
              <view
                id="timer-opt-{{index}}"
                class="timer-opt {{selectedTimerIndex === index ? 'active' : ''}}"
                data-index="{{index}}"
                data-minutes="{{item}}"
                bindtap="onTimerOptionTap"
              >
                <text class="opt-text">{{item === 0 ? 'å…³' : item}}</text>
              </view>
            </block>
          </view>
        </scroll-view>
      </view>

      <!-- å•ä½æç¤º -->
      <view class="timer-unit-hint">
        <text class="unit-text">å•ä½ï¼šåˆ†é’Ÿ</text>
      </view>

      <!-- åº•éƒ¨å¿«æ·æŒ‰é’® -->
      <view class="timer-actions">
        <view class="action-card" bindtap="onEndOfTrackTap">
          <view class="action-icon-wrap">
            <image class="action-icon" src="/images/icons/clock.svg" mode="aspectFit"></image>
          </view>
          <view class="action-content">
            <text class="action-title">æœ¬é›†ç»“æŸåå…³é—­</text>
            <text class="action-desc">{{remainingTimeStr}}</text>
          </view>
        </view>
        <view class="action-card" bindtap="onLastTimerTap">
          <view class="action-icon-wrap">
            <image class="action-icon" src="/images/icons/repeat.svg" mode="aspectFit"></image>
          </view>
          <view class="action-content">
            <text class="action-title">ä¸Šæ¬¡å®šæ—¶æ—¶é—´</text>
            <text class="action-desc">{{lastTimerMinutes > 0 ? lastTimerMinutes + ' åˆ†é’Ÿ' : 'æœªè®¾ç½®'}}</text>
          </view>
        </view>
      </view>

      <!-- åº•éƒ¨å®‰å…¨åŒº -->
      <view class="panel-safe-bottom"></view>
    </view>
  </view>
</view>
