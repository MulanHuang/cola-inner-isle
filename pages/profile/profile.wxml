<!--pages/profile/profile.wxml-->
<!-- è‡ªå®šä¹‰å¯¼èˆªæ  -->
<view class="custom-navbar" style="padding-top: {{statusBarHeight}}px;">
  <view class="navbar-content">
    <image class="navbar-logo" src="/images/logo.svg" mode="aspectFit"></image>
    <view class="navbar-title">å¯ä¹å¿ƒå²›</view>
  </view>
</view>

<view class="profile-container page-with-custom-navbar" style="padding-top: {{navBarHeight}}px;">
  <!-- å¡ç‰‡ä¸€ï¼šå¤´åƒ + åç§° + æ•°æ®ç»Ÿè®¡ -->
  <view class="card hero-card">
    <view class="hero-wave wave-one"></view>
    <view class="hero-wave wave-two"></view>
    <view class="hero-body">
      <!-- å¤´åƒé€‰æ‹©æŒ‰é’®ï¼šä½¿ç”¨å¾®ä¿¡å¤´åƒæ˜µç§°å¡«å†™èƒ½åŠ› -->
      <button class="avatar-shell avatar-btn"
              open-type="chooseAvatar"
              bindchooseavatar="onChooseAvatar">
        <image class="user-avatar" src="{{userInfo.avatarUrl || '/images/default-avatar.png'}}" mode="aspectFill"></image>
        <view class="avatar-edit-hint">æ¢</view>
      </button>
      <view class="hero-text">
        <view class="hero-name-row">
          <!-- æ˜µç§°è¾“å…¥æ¡†ï¼štype=nickname ä¼šæ˜¾ç¤ºå¾®ä¿¡æ˜µç§°é”®ç›˜ -->
          <input type="nickname"
                 class="hero-name hero-name-input"
                 value="{{userInfo.name}}"
                 placeholder="ç‚¹å‡»è®¾ç½®æ˜µç§°"
                 placeholder-class="hero-name-placeholder"
                 bindblur="onNicknameBlur"
                 bindinput="onNicknameInput"
                 maxlength="20" />
        </view>
        <view class="hero-meta-row">
          <!-- æ˜Ÿåº§å±•ç¤ºï¼šæ ¹æ®ç”Ÿæ—¥è‡ªåŠ¨è®¡ç®— -->
          <view class="hero-zodiac" wx:if="{{userZodiac}}" bindtap="goToProfileInfo">
            <text class="zodiac-emoji">{{userZodiac.emoji}}</text>
            <text class="zodiac-name">{{userZodiac.name}}</text>
          </view>
          <view class="hero-chip ghost" bindtap="goToProfileInfo">å®Œå–„æ¡£æ¡ˆ</view>
        </view>
        <view class="hero-sub hero-quote">
          <text class="quote-mark">â€œ</text>
          <text class="quote-content">{{dailyAffirmation || 'ä¿æŒè¿™ä»½çƒ­æƒ…ï¼Œä½ å¾ˆé—ªè€€ ğŸ‘‹'}}</text>
          <text class="quote-mark">â€</text>
        </view>
      </view>
    </view>
    <!-- æ•°æ®ç»Ÿè®¡åŒº -->
    <view class="hero-stats">
      <view class="stat-item" bindtap="goToMeditationHistory">
        <text class="stat-value">{{stats.meditationCount || 0}}</text>
        <text class="stat-label">æ¬¡å†¥æƒ³</text>
      </view>
      <view class="stat-divider"></view>
      <view class="stat-item" bindtap="goToTarotHistory">
        <text class="stat-value">{{stats.tarotCount || 0}}</text>
        <text class="stat-label">æ¬¡å¡”ç½—</text>
      </view>
      <view class="stat-divider"></view>
      <view class="stat-item">
        <text class="stat-value">{{totalCheckinDays || 0}}</text>
        <text class="stat-label">å¤©ç­¾åˆ°</text>
      </view>
    </view>
  </view>

  <!-- å¡ç‰‡äºŒï¼šæ¯æ—¥ç­¾åˆ° -->
  <view class="card checkin-card">
    <view class="checkin-header">
      <view class="card-title">æ¯æ—¥ç­¾åˆ°</view>
      <view class="checkin-stats">æœ¬å‘¨ {{weekCheckinCount}}/7 å¤©</view>
    </view>
    <view class="checkin-track">
      <view
        wx:for="{{weekDays}}"
        wx:key="date"
        class="checkin-dot {{item.checked ? 'checked' : ''}} {{item.isToday ? 'today' : ''}} {{item.isPast && !item.checked ? 'missed' : ''}}"
      >
        <text wx:if="{{item.isToday}}">{{item.checked ? 'âœ“' : 'ä»Š'}}</text>
        <text wx:elif="{{item.checked}}">âœ“</text>
        <text wx:else>{{item.label}}</text>
      </view>
    </view>
    <view
      class="checkin-btn {{!todayChecked && !checkinLoading ? 'shimmer' : ''}} {{todayChecked ? 'checked' : ''}} {{checkinLoading ? 'loading' : ''}}"
      bindtap="handleCheckinTap"
    >
      {{checkinLoading ? 'ç­¾åˆ°ä¸­...' : (todayChecked ? 'ä»Šæ—¥å·²ç­¾åˆ° âœ“' : 'ç«‹å³ç­¾åˆ°')}}
    </view>
  </view>

  <!-- å¡ç‰‡ä¸‰ï¼šæˆ‘çš„å†…å®¹ -->
  <view class="card content-card">
    <view class="card-title">æˆ‘çš„å†…å®¹</view>
    <view class="content-grid">
      <view class="content-chip primary" bindtap="goToProfileInfo">
        <text class="chip-icon">ğŸªª</text>
        <text class="chip-text">ä¸ªäººæ¡£æ¡ˆ</text>
      </view>
      <view class="content-chip primary" bindtap="goToMeditationHistory">
        <text class="chip-icon">ğŸ§˜</text>
        <text class="chip-text">å†¥æƒ³è®°å½•</text>
      </view>
      <view class="content-chip primary" bindtap="goToTarotHistory">
        <text class="chip-icon">ğŸ”®</text>
        <text class="chip-text">å¡”ç½—å†å²</text>
      </view>
      <view class="content-chip" bindtap="goToExplore">
        <text class="chip-icon">ğŸŒ±</text>
        <text class="chip-text">è‡ªæˆ‘æ¢ç´¢</text>
      </view>
      <view class="content-chip primary" bindtap="goToEmotionHistory">
        <text class="chip-icon">ğŸ“</text>
        <text class="chip-text">æƒ…ç»ªå†å²</text>
      </view>
      <view class="content-chip" bindtap="showAbout">
        <text class="chip-icon">â„¹ï¸</text>
        <text class="chip-text">å…³äºæˆ‘ä»¬</text>
      </view>
    </view>
  </view>

  <!-- é¡µé¢åº•éƒ¨ä¿¡æ¯ -->
  <view class="page-footer">
    <text class="footer-text">å¯ä¹å¿ƒå²› v1.0.0</text>
    <text class="footer-sub">ä½ çš„å¿ƒçµé™ªä¼´è€… ğŸ’–</text>
  </view>
</view>

<!-- å…¨å±€æ‚¬æµ®éŸ³ä¹æ§åˆ¶æŒ‰é’® -->
<audio-float />
